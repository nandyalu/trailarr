import{a as pe}from"./chunk-7CHTDGY4.js";import{a as K}from"./chunk-PXQZTDA3.js";import{a as me,b as de}from"./chunk-B265KLA7.js";import{E as w,a as X,c as Y,d as ee,e as te,f as oe,g as ne,h as ie,l as re,q as le,r as ae,s as se,y as ce,z as ge}from"./chunk-Z5MLSR7V.js";import{a as ue}from"./chunk-D6DKQXGF.js";import{$a as P,Ba as v,Bb as W,D as Z,Db as A,Fb as J,H as u,Ia as R,J as k,K as D,Ka as j,L as m,La as d,M as F,Ma as f,Na as b,O as Q,Pa as U,Pb as S,Q as h,Qa as $,Ra as G,Wa as O,X as a,ab as q,ba as V,eb as H,fb as B,ka as _,la as C,na as N,oa as y,pa as x,qa as L,ra as r,rb as z,sa as i,ta as c,v as T,w as E,ya as I,za as M}from"./chunk-W2THRVT5.js";var ve=(()=>{let o=class o{constructor(){this.http=u(W),this.logsUrl=`${S.apiUrl}${S.logs}`,this.downloadLogs=()=>this.http.get(this.logsUrl+"download",{responseType:"blob"}),this.getLogs=()=>this.http.get(this.logsUrl),this.getRawLogs=()=>this.http.get(this.logsUrl+"raw")}};o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})();var Ce=(t,o)=>o.id;function Le(t,o){if(t&1&&(r(0,"option",6),d(1),P(2,"titlecase"),i()),t&2){let n=o.$implicit,e=v();L("value",n)("selected",e.selectedLogLevel()===n),a(),f(q(2,3,n))}}function Me(t,o){t&1&&c(0,"app-load-indicator",11)}function we(t,o){t&1&&(m(),r(0,"svg",17),c(1,"path",21),i())}function ye(t,o){t&1&&(m(),r(0,"svg",17),c(1,"path",22),i())}function xe(t,o){t&1&&(m(),r(0,"svg",17),c(1,"path",23),i())}function be(t,o){t&1&&(m(),r(0,"svg",17),c(1,"path",24),i())}function Oe(t,o){t&1&&(m(),r(0,"svg",17),c(1,"path",25),i())}function Pe(t,o){if(t&1&&(r(0,"details",20)(1,"summary")(2,"small"),d(3,"Exception Details (click to show/hide)"),i()(),r(4,"pre",26),d(5),i()()),t&2){let n=v().$implicit;a(5),f(n.traceback)}}function qe(t,o){if(t&1&&(r(0,"div",14)(1,"details")(2,"summary")(3,"p",15)(4,"i",16),_(5,we,2,0,":svg:svg",17)(6,ye,2,0,":svg:svg",17)(7,xe,2,0,":svg:svg",17)(8,be,2,0,":svg:svg",17)(9,Oe,2,0,":svg:svg",17),i(),r(10,"strong"),d(11),i(),d(12),i(),r(13,"small",18),d(14),P(15,"timeago"),i()(),r(16,"p",19),d(17),i(),_(18,Pe,6,1,"details",20),i()()),t&2){let n=o.$implicit,e=v(2);a(3),j(O("logs-text ",n.level.toLowerCase())),L("title",O("",n.level.toLowerCase()," log")),a(2),C(n.level===e.logLevels.Info?5:n.level===e.logLevels.Debug?6:n.level===e.logLevels.Warning?7:n.level===e.logLevels.Error||n.level===e.logLevels.Exception||n.level===e.logLevels.Critical?8:9),a(6),b("",n.loggername,": "),a(),b("",n.message," "),a(2),f(q(15,11,n.created)),a(3),f(e.getRawLog(n)),a(),C(n.traceback?18:-1)}}function Se(t,o){if(t&1){let n=I();r(0,"div",13),M("nearEnd",function(){k(n);let l=v();return D(l.loadMore())}),y(1,qe,19,13,"div",14,Ce),i()}if(t&2){let n=v();a(),x(n.filteredLogs())}}var he=(()=>{let o=class o{constructor(){this.destroyRef=u(Q),this.logsService=u(ve),this.route=u(J),this.title="Logs",this.logLevels=w,this.allLogLevels=Object.values(w),this.searchForm=new oe,this.displayCount=h(100),this.allLogs=A(()=>({url:this.logsService.logsUrl+"raw",method:"GET",params:{level:this.selectedLogLevel().toUpperCase(),limit:this.limit()}}),{defaultValue:[]}),this.searchQuery=h(""),this.selectedLogLevel=h(w.Info),this.limit=h(1e3),this.filteredLogs=H(()=>{let e=this.searchQuery(),l=this.allLogs.value();return!e||e.length<3?l.slice(0,this.displayCount()):l.filter(s=>Object.values(s).map(fe=>fe?.toString()||"").join(" | ").toLowerCase().includes(e.toLowerCase()))}),this.resetDisplayCount=B(()=>{this.searchQuery().length<3&&this.displayCount.set(100),this.selectedLogLevel(),this.displayCount.set(100)})}ngOnInit(){this.route.queryParams.subscribe(e=>{let l=e.filter;l&&(this.searchForm.setValue(l),this.searchQuery.set(l))}),this.searchForm.valueChanges.pipe(T(400),E(),K(this.destroyRef)).subscribe(e=>{this.searchQuery.set(e)})}getRawLog(e){return`${e.created}: [${e.level}|${e.filename}|${e.lineno}] ${e.loggername} ${e.message}`}downloadLogs(){let e=this.filteredLogs().map(p=>this.getRawLog(p)).join(`
`),l=new Blob([e],{type:"text/plain"}),s=window.URL.createObjectURL(l),g=document.createElement("a");g.href=s,g.download=`trailarr-logs-${new Date().toISOString()}.txt`,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(s)}loadMore(){let e=this.displayCount();if(e>=this.allLogs.value().length){this.limit.update(l=>l+1e3);return}this.displayCount.set(e+30)}};o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=V({type:o,selectors:[["app-logs"]],decls:15,vars:5,consts:[[1,"logs-container"],[1,"logssearch"],["title","Refresh",1,"icononly-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960",1,"refresh-icon"],["d","M343-107q-120-42-194.5-146.5T74-490q0-29 4-57.5T91-604l-57 33-37-62 185-107 106 184-63 36-54-92q-13 30-18.5 60.5T147-490q0 113 65.5 200T381-171l-38 64Zm291-516v-73h107q-47-60-115.5-93.5T480-823q-66 0-123.5 24T255-734l-38-65q54-45 121-71t142-26q85 0 160.5 33T774-769v-67h73v213H634ZM598-1 413-107l107-184 62 37-54 94q123-17 204.5-110.5T814-489q0-19-2.5-37.5T805-563h74q4 18 6 36.5t2 36.5q0 142-87 251.5T578-96l56 33-36 62Z"],["name","logs-type","id","logs-type-select",1,"logs-type-select",3,"ngModelChange","ngModel"],[3,"value","selected"],["id","searchForm",1,"logssearch-form"],["type","search","autocomplete","off","name","query","placeholder","Filter logs...","aria-label","filter logs",3,"formControl"],["title","Download Logs",1,"icononly-button",3,"click"],["d","M480-313 287-506l43-43 120 120v-371h60v371l120-120 43 43-193 193ZM220-160q-24 0-42-18t-18-42v-143h60v143h520v-143h60v143q0 24-18 42t-42 18H220Z"],[1,"center"],["appScrollNearEnd","",1,"logs-table"],["appScrollNearEnd","",1,"logs-table",3,"nearEnd"],[1,"logs-row"],[3,"title"],[1,"logs-icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],[1,"logs-dt"],[1,"logs-raw"],[1,"logs-details"],["d","M453-280h60v-240h-60v240Zm26.98-314q14.02 0 23.52-9.2T513-626q0-14.45-9.48-24.22-9.48-9.78-23.5-9.78t-23.52 9.78Q447-640.45 447-626q0 13.6 9.48 22.8 9.48 9.2 23.5 9.2Zm.29 514q-82.74 0-155.5-31.5Q252-143 197.5-197.5t-86-127.34Q80-397.68 80-480.5t31.5-155.66Q143-709 197.5-763t127.34-85.5Q397.68-880 480.5-880t155.66 31.5Q709-817 763-763t85.5 127Q880-563 880-480.27q0 82.74-31.5 155.5Q817-252 763-197.68q-54 54.31-127 86Q563-80 480.27-80Zm.23-60Q622-140 721-239.5t99-241Q820-622 721.19-721T480-820q-141 0-240.5 98.81T140-480q0 141 99.5 240.5t241 99.5Zm-.5-340Z"],["d","M320-242 80-482l242-242 43 43-199 199 197 197-43 43Zm318 2-43-43 199-199-197-197 43-43 240 240-242 242Z"],["d","m40-120 440-760 440 760H40Zm104-60h672L480-760 144-180Zm340.18-57q12.82 0 21.32-8.68 8.5-8.67 8.5-21.5 0-12.82-8.68-21.32-8.67-8.5-21.5-8.5-12.82 0-21.32 8.68-8.5 8.67-8.5 21.5 0 12.82 8.68 21.32 8.67 8.5 21.5 8.5ZM454-348h60v-224h-60v224Zm26-122Z"],["d","M479.91-120q-28.91 0-49.41-20.59-20.5-20.59-20.5-49.5t20.59-49.41q20.59-20.5 49.5-20.5t49.41 20.59q20.5 20.59 20.5 49.5t-20.59 49.41q-20.59 20.5-49.5 20.5ZM410-360v-480h140v480H410Z"],["d","M477.03-246Q493-246 504-257.03q11-11.03 11-27T503.97-311q-11.03-11-27-11T450-310.97q-11 11.03-11 27T450.03-257q11.03 11 27 11ZM444-394h57q0-31 10-50.5t34.72-44.22Q579-522 592-547.5t13-53.5q0-53-34-84t-91.52-31q-51.87 0-88.17 24.5Q355-667 338-624l53 22q14-28 36.2-42.5Q449.4-659 479-659q32 0 50.5 16t18.5 44.1q0 19.9-11 38.4T500-517q-37 35-46.5 60t-9.5 63ZM180-120q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h600q24 0 42 18t18 42v600q0 24-18 42t-42 18H180Zm0-60h600v-600H180v600Zm0-600v600-600Z"],[1,"logs-pre"]],template:function(l,s){l&1&&(r(0,"div",0)(1,"div",1)(2,"i",2),M("click",function(){return s.allLogs.reload()}),m(),r(3,"svg",3),c(4,"path",4),i()(),F(),r(5,"select",5),G("ngModelChange",function(p){return $(s.selectedLogLevel,p)||(s.selectedLogLevel=p),p}),y(6,Le,3,5,"option",6,N),i(),r(8,"form",7),c(9,"input",8),i(),r(10,"a",9),M("click",function(){return s.downloadLogs()}),m(),r(11,"svg",3),c(12,"path",10),i()()(),_(13,Me,1,0,"app-load-indicator",11)(14,Se,3,0,"div",12),i()),l&2&&(a(2),R("loading",s.allLogs.isLoading()),a(3),U("ngModel",s.selectedLogLevel),a(),x(s.allLogLevels),a(3),L("formControl",s.searchForm),a(4),C(s.allLogs.isLoading()&&s.allLogs.value().length===0?13:14))},dependencies:[ce,ie,ae,se,X,le,Y,ee,ne,te,ue,ge,re,pe,de,me,z],styles:[".logs-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.logssearch[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;width:auto;flex-grow:1;padding:1rem;background-color:var(--color-surface-container-low);position:sticky;top:76px;z-index:2;gap:.5rem}@media (width < 765px){.logssearch[_ngcontent-%COMP%]{padding:.5rem;top:76px}}.refresh-icon[_ngcontent-%COMP%]{cursor:pointer;fill:var(--color-on-surface)}.loading[_ngcontent-%COMP%]{cursor:progress;animation:spin-animation 2s linear infinite}.logs-type-select[_ngcontent-%COMP%]{width:10rem;padding:.5rem;border:1px solid var(--color-outline);border-radius:.5rem;background-color:var(--color-surface-container-highest);color:var(--color-on-surface);font-size:1rem}.logs-type-select[_ngcontent-%COMP%]:focus{outline:var(--color-primary);border:1px solid var(--color-primary)}.logssearch-form[_ngcontent-%COMP%]{width:100%}.logssearch-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid var(--color-outline);border-radius:.5rem;margin:0;font-size:1rem;background-color:var(--color-surface-container-highest);color:var(--color-on-surface)}.logssearch-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:var(--color-primary);border:1px solid var(--color-primary)}.logs-table[_ngcontent-%COMP%]{padding:1rem}.logs-row[_ngcontent-%COMP%]{padding:10px;border-bottom:2px solid var(--color-outline-variant)}@media (width < 765px){.logs-row[_ngcontent-%COMP%]{padding:0}}.logs-row[_ngcontent-%COMP%]   details[_ngcontent-%COMP%]{width:100%;list-style-position:outside}.logs-row[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{list-style-position:outside;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;cursor:pointer;position:relative}@media (width < 765px){.logs-row[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{flex-direction:column;align-items:baseline;gap:0;margin-bottom:1rem}}summary[_ngcontent-%COMP%]   .logs-text[_ngcontent-%COMP%]{flex:1;margin-left:2rem}.logs-pre[_ngcontent-%COMP%]{text-wrap:auto;white-space:pre-wrap;word-break:break-word;margin:.5rem 0;padding:1rem;border-radius:1rem;background-color:var(--color-surface-container-highest)}.logs-icon[_ngcontent-%COMP%]{position:absolute;top:.75rem;left:0;font-size:0;z-index:0}.logs-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:1.5rem;fill:var(--color-outline)}summary[_ngcontent-%COMP%]   .debug[_ngcontent-%COMP%]{color:var(--color-info)}summary[_ngcontent-%COMP%]   .debug[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-info)}summary[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:var(--color-danger)}summary[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-danger)}summary[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--color-warning)}summary[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-warning)}"],changeDetection:0});let t=o;return t})();var Ye=[{path:"",loadComponent:()=>he}];export{Ye as default};
