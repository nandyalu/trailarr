import{a as E}from"./chunk-2XBANTUS.js";import{b as p,c as f,d as o,e as I,f as A,g as U,h as L,k as O}from"./chunk-TDHWVRPW.js";import{p as C}from"./chunk-ZEQ6WCJQ.js";import{a as w}from"./chunk-3OXZ5NJK.js";import{E as v,I as y,Mb as g,Pb as b,Rb as x,T as l,a as _,b as D,c as F,l as c,p as $,rb as m}from"./chunk-IMRADBSH.js";function G(i){let r=Math.floor(i/60),e=Math.floor(i%60);return r===0?`${e}m`:e===0?`${r}h`:`${r}h ${e}m`}function J(i){let r=Math.floor(i/3600),e=Math.floor(i%3600/60),t=Math.floor(i%60);return r===0?`${e}m ${t}s`:`${r}h ${e}m ${t}s`}function P(i){let r=Date.now();if(i<r||(i-=r,i<0))return"0 seconds";let e=Math.floor(i/36e5),t=Math.floor(i%36e5/6e4),s=Math.floor(i%6e4/1e3);return e===0&&t===0&&s===0?"0 seconds":e===0&&t===0?`${s} seconds`:e===0?`${t} minutes ${s} seconds`:`${e} hours ${t} minutes ${s} seconds`}var Y=(i,r)=>i===r||JSON.stringify(i)===JSON.stringify(r),N=new Map;function h(i=0){return function(r,e,t){let s=t.value;t.value=function(...n){let a=`${e.toString()}:${JSON.stringify(n)}`;if(N.has(a)){let M=N.get(a);if(i>0&&Date.now()-M.timestamp>i)N.delete(a);else return M.value}let S=s.apply(this,n);return N.set(a,{value:S,timestamp:Date.now()}),S}}}function q(i){if(i===0)return"0 B";let r=1024,e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],t=Math.floor(Math.log(i)/Math.log(r));return parseFloat((i/Math.pow(r,t)).toFixed(2))+" "+e[t]}var u=class{static parseDate(r){return new Date(r)}static parseNumber(r){return parseFloat(r)}static getDaysAgo(r){let e=new Date;return e.setDate(e.getDate()-r),e}};c([h()],u,"parseDate",null);c([h()],u,"parseNumber",null);c([h()],u,"getDaysAgo",null);var d=class{static applyBooleanFilter(r,e){return r===e}static applyNumberFilter(r,e,t){switch(t){case f.GREATER_THAN:return r>e;case f.GREATER_THAN_EQUAL:return r>=e;case f.LESS_THAN:return r<e;case f.LESS_THAN_EQUAL:return r<=e;case f.EQUALS:return r===e;case f.NOT_EQUALS:return r!==e;default:return!0}}static applyDateFilter(r,e,t,s){switch(t){case p.IS_AFTER:return r>e;case p.IS_BEFORE:return r<e;case p.IN_THE_LAST:return s?r>s:!1;case p.NOT_IN_THE_LAST:return s?r<s:!1;case p.EQUALS:return r.toDateString()===e.toDateString();case p.NOT_EQUALS:return r.toDateString()!==e.toDateString();default:return!0}}static applyStringFilter(r,e,t){switch(t){case o.CONTAINS:return r.includes(e);case o.NOT_CONTAINS:return!r.includes(e);case o.EQUALS:return r===e;case o.NOT_EQUALS:return r!==e;case o.STARTS_WITH:return r.startsWith(e);case o.NOT_STARTS_WITH:return!r.startsWith(e);case o.ENDS_WITH:return r.endsWith(e);case o.NOT_ENDS_WITH:return!r.endsWith(e);case o.IS_EMPTY:return r==="";case o.IS_NOT_EMPTY:return r!=="";default:return!0}}};c([h()],d,"applyBooleanFilter",null);c([h()],d,"applyNumberFilter",null);c([h()],d,"applyDateFilter",null);function Q(i,r){let{filter_by:e,filter_value:t,filter_condition:s}=i,n=r[e];if(I.includes(e)){let a=t.toLowerCase()==="true";return d.applyBooleanFilter(n,a)}if(A.includes(e)){let a=u.parseDate(n),S=u.parseDate(t),M=parseInt(t),k=isNaN(M)?void 0:u.getDaysAgo(M);return d.applyDateFilter(a,S,s,k)}if(U.includes(e)){let a=u.parseNumber(t);return d.applyNumberFilter(n,a,s)}return L.includes(e)?d.applyStringFilter(n,t,s):!0}function K(i,r,e){let t=i.find(s=>s.filter_name===r);return t?t.filters.every(s=>Q(s,e)):!0}function H(i,r,e){return i.filter(t=>{switch(r){case"all":return!0;case"downloaded":return t.trailer_exists;case"downloading":return t.status.toLowerCase()==="downloading";case"missing":return!t.trailer_exists;case"monitored":return t.monitor;case"unmonitored":return!t.monitor&&!t.trailer_exists;case"movies":return t.is_movie&&t.trailer_exists;case"series":return!t.is_movie&&t.trailer_exists;default:return K(e,r,t)}})}function R(i){let r=i.downloads.filter(e=>e.file_exists).map(e=>new Date(e.added_at)).sort((e,t)=>t.getTime()-e.getTime());return r.length>0?r[0]:null}function B(i,r,e){i.sort((t,s)=>{let n=t[r],a=s[r];return r==="downloaded_at"&&(n=R(t)??0,a=R(s)??0),n instanceof Date&&a instanceof Date?e?n.getTime()-a.getTime():a.getTime()-n.getTime():typeof n=="number"&&typeof a=="number"?e?n-a:a-n:e?t[r].toString().localeCompare(s[r].toString()):s[r].toString().localeCompare(t[r].toString())})}function W(i){return D(_({},i),{added_at:new Date(`${i.added_at}`),updated_at:new Date(`${i.updated_at}`),downloaded_at:new Date(`${i.downloaded_at}`),isImageLoaded:!1})}function T(i){let r=[{type:"folder",name:"None",size:"",path:"",files:[],modified:new Date,isExpanded:!1}];return i.files&&(r=i.files.map(e=>z(e)?j(e):T(e))),D(_({},i),{isExpanded:!1,modified:new Date(`${i.created}`),files:r})}function j(i){return D(_({},i),{isExpanded:!1,modified:new Date(`${i.created}`)})}function z(i){return i.type==="file"}var he=(()=>{class i{constructor(){this.httpClient=y(b),this.customfilterService=y(O),this.webSocketService=y(C),this.mediaUrl=w.apiUrl+w.media,this.customFilters=this.customfilterService.viewFilters,this.defaultDisplayCount=50,this.checkedMediaIDs=l([]),this.displayCount=l(this.defaultDisplayCount),this.inEditMode=l(!1),this.moviesOnly=l(null),this.selectedMediaID=l(null),this.selectedSort=l("added_at"),this.sortAscending=l(!0),this.selectedFilter=l("all"),this.mediaResource=x(()=>({url:this.mediaUrl+"all"}),{defaultValue:[],parse:e=>e&&Array.isArray(e)?e.map(W):[]}),this.filteredSortedMedia=m(()=>{let e=H(this.allMedia(),this.selectedFilter(),this.customFilters());return B(e,this.selectedSort(),this.sortAscending()),e}),this.displayMedia=m(()=>this.filteredSortedMedia().slice(0,this.displayCount())),this.selectedMedia=m(()=>{let e=this.selectedMediaID();return e===null?null:this.mediaResource.value().find(t=>t.id===e)||null}),this.previousMedia=m(()=>{let e=this.selectedMediaID();if(e===null)return null;let t=this.filteredSortedMedia(),s=t.findIndex(n=>n.id===e);return s>0?t[s-1]:null}),this.nextMedia=m(()=>{let e=this.selectedMediaID();if(e===null)return null;let t=this.filteredSortedMedia(),s=t.findIndex(n=>n.id===e);return s<t.length-1?t[s+1]:null}),this.allMedia=m(()=>{switch(this.moviesOnly()){case!0:return this.mediaResource.value().filter(t=>t.is_movie);case!1:return this.mediaResource.value().filter(t=>!t.is_movie);case null:return this.mediaResource.value().filter(t=>t.downloads.some(s=>s.file_exists===!0))}}),this.webSocketService.toastMessage.pipe(E()).subscribe(e=>{e.reload?.includes("media")&&this.mediaResource.reload()})}searchMedia(e){let t=`${this.mediaUrl}search`,s=new g().set("query",e);return this.httpClient.get(t,{params:s})}batchUpdate(e,t,s=-1){let n=`${this.mediaUrl}batch_update`;return this.httpClient.post(n,{media_ids:e,action:t.toLowerCase(),profile_id:s})}downloadMediaTrailer(e,t,s){let n=new g().set("profile_id",t).set("yt_id",s),a=`${this.mediaUrl}${e}/download`;return this.httpClient.post(a,{},{params:n})}monitorMedia(e,t){let s=new g().set("monitor",t),n=`${this.mediaUrl}${e}/monitor`;return this.httpClient.post(n,{},{params:s})}deleteMediaTrailer(e){let t=`${this.mediaUrl}${e}/trailer`;return this.httpClient.delete(t)}fetchMediaFiles(e){return F(this,null,function*(){let t=`${this.mediaUrl}${e}/files`,s=yield $(this.httpClient.get(t));return T(s)})}searchMediaTrailer(e,t){let s=new g().set("profile_id",t),n=`${this.mediaUrl}${e}/search`;return this.httpClient.post(n,{},{params:s})}saveMediaTrailer(e,t){let s=`${this.mediaUrl}${e}/update`,n=new g().set("yt_id",t);return this.httpClient.post(s,{},{params:n})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{G as a,J as b,P as c,Y as d,q as e,he as f};
