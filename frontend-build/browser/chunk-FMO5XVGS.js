import{a as v}from"./chunk-EWLZ4Y2T.js";import{P as b}from"./chunk-AIHHP2PA.js";import{Ac as u,Bc as h,G as f,_ as m,da as d,gc as w,r as l,sa as P,w as n}from"./chunk-77FKYVFO.js";var y=(()=>{let s=class s{constructor(){this.profilesUrl=h.apiUrl+h.trailerprofiles,this._service=d(b),this.websocketService=d(v),this.allProfiles=u(()=>this.profilesUrl,{defaultValue:[]}),this.selectedProfileId=P(0),this.fetchSelectedProfileResource=u(()=>{if(!(this.selectedProfileId()<=0||this.allProfiles.value().findIndex(e=>e.id===this.selectedProfileId())!==-1))return this.profilesUrl+this.selectedProfileId()}),this.selectedProfile=w(()=>{let r=this.selectedProfileId();if(r<=0)return;let e=this.allProfiles.value().find(t=>t.id===r);return e||this.fetchSelectedProfileResource.value()})}profileExists(r){return this.allProfiles.value().some(t=>t.id===r)?!0:(this.websocketService.showToast(`Profile with ID '${r}' does not exist.`,"error"),!1)}createProfile(r){return!r||!r.customfilter.filter_name?(this.websocketService.showToast("Profile name is required","error"),console.error("Profile creation failed: Name is required"),l(null)):this._service.createTrailerProfileApiV1TrailerprofilesPost({body:r}).pipe(n(e=>(this.allProfiles.reload(),this.selectedProfileId.set(e.id),this.websocketService.showToast(`Profile '${e.customfilter.filter_name}' created successfully!`,"success"),e.id)),f(e=>{let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to create profile:",t),this.websocketService.showToast(t,"error"),l(null)}))}updateProfile(r){return!r||!r.customfilter.filter_name?(this.websocketService.showToast("Profile name is required","error"),console.error("Profile update failed: Name is required"),l(!1)):this._service.updateTrailerProfileApiV1TrailerprofilesTrailerprofileIdPut({trailerprofile_id:r.id,body:r}).pipe(n(e=>(this.allProfiles.reload(),this.websocketService.showToast(`Profile '${e.customfilter.filter_name}' updated successfully!`,"success"),!0)),f(e=>{let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to update profile:",t),this.websocketService.showToast(t,"error"),l(!1)}))}updateSetting(r,e){let t=this.selectedProfileId();if(t<=0)throw new Error("No profile selected");this._service.updateTrailerProfileSettingApiV1TrailerprofilesTrailerprofileIdSettingPost({trailerprofile_id:t,body:{key:r,value:e}}).subscribe({next:i=>{this.allProfiles.update(c=>{let p=c.findIndex(T=>T.id===i.id);return p!==-1?(c[p]=i,[...c]):[...c,i]});let o=r.charAt(0).toUpperCase()+r.replaceAll("_"," ").slice(1);this.websocketService.showToast(`${o} set to '${e}' successfully!`,"success")},error:i=>{let o="An unknown error occurred!";i.error instanceof ErrorEvent?o=`Error: ${i.error.message}`:o=`Error: ${i.status} ${i.error.detail}`,console.error("Failed to update profile setting:",o),this.websocketService.showToast(o,"error")}})}deleteProfile(r){if(r<=0)throw new Error("Invalid profile ID");this._service.deleteTrailerProfileApiV1TrailerprofilesTrailerprofileIdDelete({trailerprofile_id:r}).subscribe({next:()=>{this.selectedProfileId.set(0),this.allProfiles.reload(),this.websocketService.showToast("Profile deleted successfully!","success")},error:e=>{let t="An unknown error occurred!";e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to delete profile:",t),this.websocketService.showToast(t,"error")}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();export{y as a};
