import{a as C}from"./chunk-DBIAIPXM.js";import{C as p,D as h,E as o,F as E,G as x,H as A,I as L,K as U}from"./chunk-AQ74DYQU.js";import{a as O}from"./chunk-RSH2SXVD.js";import{Ac as w,_ as v,a as y,b as D,c as F,da as _,fc as m,p as c,sa as l,uc as S,v as b,xc as I,zc as $}from"./chunk-QTP5QHJU.js";function B(s){let t=Math.floor(s/60),i=Math.floor(s%60);return t===0?`${i}m`:i===0?`${t}h`:`${t}h ${i}m`}function J(s){let t=Date.now();if(s<t||(s-=t,s<0))return"0 seconds";let i=Math.floor(s/36e5),e=Math.floor(s%36e5/6e4),r=Math.floor(s%6e4/1e3);return i===0&&e===0&&r===0?"0 seconds":i===0&&e===0?`${r} seconds`:i===0?`${e} minutes ${r} seconds`:`${i} hours ${e} minutes ${r} seconds`}var q=(s,t)=>s===t||JSON.stringify(s)===JSON.stringify(t),N=new Map;function f(s=0){return function(t,i,e){let r=e.value;e.value=function(...n){let a=`${i.toString()}:${JSON.stringify(n)}`;if(N.has(a)){let M=N.get(a);if(s>0&&Date.now()-M.timestamp>s)N.delete(a);else return M.value}let g=r.apply(this,n);return N.set(a,{value:g,timestamp:Date.now()}),g}}}var u=class{static parseDate(t){return new Date(t)}static parseNumber(t){return parseFloat(t)}static getDaysAgo(t){let i=new Date;return i.setDate(i.getDate()-t),i}};c([f()],u,"parseDate",null);c([f()],u,"parseNumber",null);c([f()],u,"getDaysAgo",null);var d=class{static applyBooleanFilter(t,i){return t===i}static applyNumberFilter(t,i,e){switch(e){case h.GREATER_THAN:return t>i;case h.GREATER_THAN_EQUAL:return t>=i;case h.LESS_THAN:return t<i;case h.LESS_THAN_EQUAL:return t<=i;case h.EQUALS:return t===i;case h.NOT_EQUALS:return t!==i;default:return!0}}static applyDateFilter(t,i,e,r){switch(e){case p.IS_AFTER:return t>i;case p.IS_BEFORE:return t<i;case p.IN_THE_LAST:return r?t>r:!1;case p.NOT_IN_THE_LAST:return r?t<r:!1;case p.EQUALS:return t.toDateString()===i.toDateString();case p.NOT_EQUALS:return t.toDateString()!==i.toDateString();default:return!0}}static applyStringFilter(t,i,e){switch(e){case o.CONTAINS:return t.includes(i);case o.NOT_CONTAINS:return!t.includes(i);case o.EQUALS:return t===i;case o.NOT_EQUALS:return t!==i;case o.STARTS_WITH:return t.startsWith(i);case o.NOT_STARTS_WITH:return!t.startsWith(i);case o.ENDS_WITH:return t.endsWith(i);case o.NOT_ENDS_WITH:return!t.endsWith(i);case o.IS_EMPTY:return t==="";case o.IS_NOT_EMPTY:return t!=="";default:return!0}}};c([f()],d,"applyBooleanFilter",null);c([f()],d,"applyNumberFilter",null);c([f()],d,"applyDateFilter",null);function Q(s,t){let{filter_by:i,filter_value:e,filter_condition:r}=s,n=t[i];if(E.includes(i)){let a=e.toLowerCase()==="true";return d.applyBooleanFilter(n,a)}if(x.includes(i)){let a=u.parseDate(n),g=u.parseDate(e),M=parseInt(e),W=isNaN(M)?void 0:u.getDaysAgo(M);return d.applyDateFilter(a,g,r,W)}if(A.includes(i)){let a=u.parseNumber(e);return d.applyNumberFilter(n,a,r)}return L.includes(i)?d.applyStringFilter(n,e,r):!0}function K(s,t,i){let e=s.find(r=>r.filter_name===t);return e?e.filters.every(r=>Q(r,i)):!0}function R(s,t,i){return s.filter(e=>{switch(t){case"all":return!0;case"downloaded":return e.trailer_exists;case"downloading":return e.status.toLowerCase()==="downloading";case"missing":return!e.trailer_exists;case"monitored":return e.monitor;case"unmonitored":return!e.monitor&&!e.trailer_exists;case"movies":return e.is_movie&&e.trailer_exists;case"series":return!e.is_movie&&e.trailer_exists;default:return K(i,t,e)}})}function H(s,t,i){s.sort((e,r)=>{let n=e[t],a=r[t];return n instanceof Date&&a instanceof Date?i?n.getTime()-a.getTime():a.getTime()-n.getTime():typeof n=="number"&&typeof a=="number"?i?n-a:a-n:i?e[t].toString().localeCompare(r[t].toString()):r[t].toString().localeCompare(e[t].toString())})}function k(s){return D(y({},s),{added_at:new Date(`${s.added_at}Z`),updated_at:new Date(`${s.updated_at}Z`),downloaded_at:new Date(`${s.downloaded_at}Z`),isImageLoaded:!1})}function T(s){let t=[{type:"folder",name:"None",size:"",path:"",files:[],modified:new Date,isExpanded:!1}];return s.files&&(t=s.files.map(i=>j(i)?Z(i):T(i))),D(y({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`),files:t})}function Z(s){return D(y({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`)})}function j(s){return s.type==="file"}var me=(()=>{let t=class t{constructor(){this.httpClient=_(I),this.customfilterService=_(U),this.webSocketService=_(O),this.mediaUrl=w.apiUrl+w.media,this.customFilters=this.customfilterService.viewFilters,this.defaultDisplayCount=50,this.checkedMediaIDs=l([]),this.displayCount=l(this.defaultDisplayCount),this.inEditMode=l(!1),this.moviesOnly=l(null),this.selectedMediaID=l(null),this.selectedSort=l("added_at"),this.sortAscending=l(!0),this.selectedFilter=l("all"),this.mediaResource=$(()=>({url:this.mediaUrl+"all"}),{defaultValue:[],parse:e=>e&&Array.isArray(e)?e.map(k):[]}),this.filteredSortedMedia=m(()=>{let e=R(this.allMedia(),this.selectedFilter(),this.customFilters());return H(e,this.selectedSort(),this.sortAscending()),e}),this.displayMedia=m(()=>this.filteredSortedMedia().slice(0,this.displayCount())),this.selectedMedia=m(()=>{let e=this.selectedMediaID();return e===null?null:this.mediaResource.value().find(r=>r.id===e)||null}),this.previousMedia=m(()=>{let e=this.selectedMediaID();if(e===null)return null;let r=this.filteredSortedMedia(),n=r.findIndex(a=>a.id===e);return n>0?r[n-1]:null}),this.nextMedia=m(()=>{let e=this.selectedMediaID();if(e===null)return null;let r=this.filteredSortedMedia(),n=r.findIndex(a=>a.id===e);return n<r.length-1?r[n+1]:null}),this.allMedia=m(()=>{switch(this.moviesOnly()){case!0:return this.mediaResource.value().filter(r=>r.is_movie);case!1:return this.mediaResource.value().filter(r=>!r.is_movie);case null:return this.mediaResource.value().filter(r=>r.status.toLowerCase()==="downloaded")}}),this.webSocketService.toastMessage.pipe(C()).subscribe(e=>{let r=e.message.toLowerCase();["media","trailer","task","download","batch","update","delete","monitor","unmonitor"].some(a=>a&&r.includes(a))&&this.mediaResource.reload()})}searchMedia(e){let r=`${this.mediaUrl}search`,n=new S().set("query",e);return this.httpClient.get(r,{params:n})}batchUpdate(e,r,n=-1){let a=`${this.mediaUrl}batch_update`;return this.httpClient.post(a,{media_ids:e,action:r.toLowerCase(),profile_id:n})}downloadMediaTrailer(e,r,n){let a=new S().set("profile_id",r).set("yt_id",n),g=`${this.mediaUrl}${e}/download`;return this.httpClient.post(g,{},{params:a})}monitorMedia(e,r){let n=new S().set("monitor",r),a=`${this.mediaUrl}${e}/monitor`;return this.httpClient.post(a,{},{params:n})}deleteMediaTrailer(e){let r=`${this.mediaUrl}${e}/trailer`;return this.httpClient.delete(r)}fetchMediaFiles(e){return F(this,null,function*(){let r=`${this.mediaUrl}${e}/files`,n=yield b(this.httpClient.get(r));return T(n)})}searchMediaTrailer(e,r){let n=new S().set("profile_id",r),a=`${this.mediaUrl}${e}/search`;return this.httpClient.post(a,{},{params:n})}saveMediaTrailer(e,r){let n=`${this.mediaUrl}${e}/update`,a=new S().set("yt_id",r);return this.httpClient.post(n,{},{params:a})}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"});let s=t;return s})();export{B as a,J as b,q as c,me as d};
