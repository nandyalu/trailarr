import{a as tt}from"./chunk-PXQZTDA3.js";import{e as Y,p as et}from"./chunk-WJEF7JOU.js";import{a as nt}from"./chunk-D6DKQXGF.js";import{$a as p,Ba as h,Bb as K,D as R,H as _,Ib as X,J as H,K as N,L as w,La as r,M as V,Ma as d,Pb as $,X as m,Xa as A,Ya as y,a as P,ab as k,b as q,ba as j,bb as C,ea as Q,f as F,ka as v,la as x,oa as O,p as g,pa as E,qa as G,qb as J,ra as a,s as U,sa as i,ta as c,w as Z,ya as W,z as B,za as z}from"./chunk-W2THRVT5.js";var ot=1e3,I=60*ot,L=60*I,it=24*L,rt=(()=>{let n=class n{transform(t,o="Invalid date"){return t?U(1e3).pipe(B(0),g(()=>this.getTimeDifferenceString(t,o)),Z()):new F(l=>{l.next(o),l.complete()})}getTimeDifferenceString(t,o="Invalid date"){if(!t)return o;let l=new Date(t);if(isNaN(l.getTime()))return console.log("Invalid date in TimediffPipe:",t),o;let u=new Date().getTime()-l.getTime(),T=u<0?"from now":"ago";u=Math.abs(u);let S=Math.floor(u/it);if(S>0)return`${S} day${S!==1?"s":""} ${T}`;let M=Math.floor(u%it/L);if(M>0)return`${M} hour${M!==1?"s":""} ${T}`;let b=Math.floor(u%L/I);if(b>0)return`${b} minute${b!==1?"s":""} ${T}`;let D=Math.floor(u%I/ot);return`${D} second${D!==1?"s":""} ${T}`}};n.\u0275fac=function(o){return new(o||n)},n.\u0275pipe=Q({name:"timediff",type:n,pure:!1});let e=n;return e})();var st=(()=>{let n=class n{constructor(){this.http=_(K),this.tasksUrl=$.apiUrl+$.tasks,this.schedulesUrl=this.tasksUrl+"schedules",this.queueUrl=this.tasksUrl+"queue"}convertTime(t){let o=[{unit:"second",value:60},{unit:"minute",value:60},{unit:"hour",value:24},{unit:"day",value:7}];for(let{unit:l,value:f}of o){if(t<f)return`${t} ${l}${t===1?"":"s"}`;t=Math.floor(t/f)}return`${t} ${t===1?"week":"weeks"}`}convertDate(t){return t?new Date(t+"Z"):null}formatDuration(t){if(t<1)return"00:00:00";let o=Math.floor(t/3600).toString().padStart(2,"0"),l=Math.floor(t%3600/60).toString().padStart(2,"0"),f=(t%60).toString().padStart(2,"0");return`${o}:${l}:${f}`}getScheduledTasks(){return this.http.get(this.schedulesUrl).pipe(g(t=>Object.entries(t).map(([o,l])=>q(P({id:o},l),{interval:this.convertTime(l.interval),last_run_duration:this.formatDuration(l.last_run_duration)}))))}getQueuedTasks(){return this.http.get(this.queueUrl).pipe(g(t=>Object.entries(t).map(([o,l])=>q(P({id:o},l),{duration:this.formatDuration(l.duration)}))))}runScheduledTask(t){return this.http.get(this.tasksUrl+"run/"+t)}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var dt=e=>["/",e],ct=e=>({filter:e}),lt=(e,n)=>n.id;function pt(e,n){e&1&&c(0,"app-load-indicator",2)}function ut(e,n){if(e&1){let s=W();a(0,"td",11),z("click",function(){H(s);let o=h().$implicit,l=h(2);return o.last_run_status="Running",N(l.runTask(o.task_id))}),w(),a(1,"svg",12),c(2,"path",13),i()()}}function ht(e,n){e&1&&(a(0,"td",10),w(),a(1,"svg",14),c(2,"path",15),i()())}function ft(e,n){if(e&1&&(a(0,"tr",8)(1,"td",7),r(2),i(),a(3,"td"),r(4),i(),a(5,"td"),r(6),p(7,"timediff"),p(8,"async"),i(),a(9,"td"),r(10),i(),a(11,"td"),r(12),i(),a(13,"td"),r(14),p(15,"timediff"),p(16,"async"),i(),v(17,ut,3,0,"td",9),v(18,ht,3,0,"td",10),i()),e&2){let s=n.$implicit;m(2),d(s.name),m(2),d(s.interval),m(2),d(k(8,11,C(7,8,s.last_run_start,"Not run yet"))),m(4),d(s.last_run_status),m(2),d(s.last_run_duration),m(2),d(k(16,16,C(15,13,s.next_run,"Not scheduled"))),m(3),x(s.last_run_status.toLowerCase()!="running"?17:-1),m(),x(s.last_run_status.toLowerCase()=="running"?18:-1)}}function gt(e,n){if(e&1&&(a(0,"div",3)(1,"table",5)(2,"tr",6)(3,"th",7),r(4,"Name"),i(),a(5,"th"),r(6,"Interval"),i(),a(7,"th"),r(8,"Last Run"),i(),a(9,"th"),r(10,"Last Run Status"),i(),a(11,"th"),r(12,"Last Run Duration"),i(),a(13,"th"),r(14,"Next Run"),i(),c(15,"th"),i(),O(16,ft,19,18,"tr",8,lt),i()()),e&2){let s=h();m(16),E(s.scheduledTasks)}}function _t(e,n){e&1&&c(0,"app-load-indicator",2)}function vt(e,n){if(e&1&&(a(0,"tr",8)(1,"td",16)(2,"span"),r(3),i(),a(4,"i",17),w(),a(5,"svg",18),c(6,"path",19),i()()(),V(),a(7,"td"),r(8),i(),a(9,"td"),r(10),p(11,"timediff"),p(12,"async"),i(),a(13,"td"),r(14),p(15,"timediff"),p(16,"async"),i(),a(17,"td"),r(18),i()()),e&2){let s=n.$implicit,t=h(2);m(3),d(s.name),m(),G("routerLink",y(17,dt,t.RouteLogs))("queryParams",y(19,ct,s.trace_id)),m(4),d(s.status),m(2),d(k(12,10,C(11,7,s.started,"Pending"))),m(4),d(k(16,15,C(15,12,s.finished,"-"))),m(4),d(s.duration)}}function xt(e,n){if(e&1&&(a(0,"div",4)(1,"table",5)(2,"tr",6)(3,"th",7),r(4,"Name"),i(),a(5,"th"),r(6,"Status"),i(),a(7,"th"),r(8,"Started"),i(),a(9,"th"),r(10,"Finished"),i(),a(11,"th"),r(12,"Duration"),i()(),O(13,vt,19,21,"tr",8,lt),i()()),e&2){let s=h();m(13),E(s.queuedTasks)}}var mt=(()=>{let n=class n{constructor(){this.tasksService=_(st),this.websocketService=_(et),this.scheduledTasks=[],this.queuedTasks=[],this.isLoading1=!0,this.isLoading2=!0,this.RouteLogs=Y,this.websocketService.toastMessage.pipe(tt()).subscribe(t=>{t.reload?.includes("tasks")&&this.refreshTaskData()})}ngOnInit(){this.refreshTaskData()}refreshTaskData(){console.log("Refreshing task data"),this.tasksService.getScheduledTasks().subscribe(t=>{this.scheduledTasks=t,this.isLoading1=!1}),this.tasksService.getQueuedTasks().subscribe(t=>{this.queuedTasks=t,this.isLoading2=!1})}runTask(t){this.tasksService.runScheduledTask(t).subscribe(o=>{console.log(o)})}};n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=j({type:n,selectors:[["app-tasks"]],features:[A([])],decls:11,vars:2,consts:[[1,"tasks-container"],[1,"text-heading"],[1,"center"],[1,"table-container"],[1,"table-container","last-table"],[1,"tasks-table"],[1,"table-row","header"],[1,"name"],[1,"table-row"],["title","Run task now"],["title","Task is running"],["title","Run task now",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M382-306.67 653.33-480 382-653.33v346.66ZM480-80q-82.33 0-155.33-31.5-73-31.5-127.34-85.83Q143-251.67 111.5-324.67T80-480q0-83 31.5-156t85.83-127q54.34-54 127.34-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 82.33-31.5 155.33-31.5 73-85.5 127.34Q709-143 636-111.5T480-80Z"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960",1,"loading"],["d","M343-107q-120-42-194.5-146.5T74-490q0-29 4-57.5T91-604l-57 33-37-62 185-107 106 184-63 36-54-92q-13 30-18.5 60.5T147-490q0 113 65.5 200T381-171l-38 64Zm291-516v-73h107q-47-60-115.5-93.5T480-823q-66 0-123.5 24T255-734l-38-65q54-45 121-71t142-26q85 0 160.5 33T774-769v-67h73v213H634ZM598-1 413-107l107-184 62 37-54 94q123-17 204.5-110.5T814-489q0-19-2.5-37.5T805-563h74q4 18 6 36.5t2 36.5q0 142-87 251.5T578-96l56 33-36 62Z"],[1,"name","queue-name"],["title","View Logs",3,"routerLink","queryParams"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960",1,"icon"],["d","M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"]],template:function(o,l){o&1&&(a(0,"div",0)(1,"div",1),r(2,"Scheduled"),i(),c(3,"hr"),v(4,pt,1,0,"app-load-indicator",2)(5,gt,18,0,"div",3),a(6,"div",1),r(7,"Queue"),i(),c(8,"hr"),v(9,_t,1,0,"app-load-indicator",2)(10,xt,15,0,"div",4),i()),o&2&&(m(4),x(l.isLoading1?4:5),m(5),x(l.isLoading1?9:10))},dependencies:[nt,X,J,rt],styles:[".tasks-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem}@media (width < 765px){.tasks-container[_ngcontent-%COMP%]{padding:.5rem}}.text-heading[_ngcontent-%COMP%]{margin-top:1rem;text-align:left;font-size:2rem}.center[_ngcontent-%COMP%]{margin:auto}.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto;min-height:25%;-webkit-overflow-scrolling:touch;margin-top:.5rem;margin-bottom:2rem}.last-table[_ngcontent-%COMP%]{margin-bottom:0}.tasks-table[_ngcontent-%COMP%]{width:100%;max-width:100%;white-space:nowrap;border-collapse:collapse}.tasks-table[_ngcontent-%COMP%]   .table-row[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-outline);white-space:nowrap;text-align:left}.tasks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tasks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem .5rem}.tasks-table[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-weight:700;border-bottom:2px solid var(--color-outline)}.tasks-table[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:100%}.tasks-table[_ngcontent-%COMP%]   .queue-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.tasks-table[_ngcontent-%COMP%]   .queue-name[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:contents}.tasks-table[_ngcontent-%COMP%]   .queue-name[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin:0;padding:0;width:1rem;height:1rem;fill:var(--color-primary);cursor:pointer}.table-row[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin:0 .5rem;width:1rem;fill:var(--color-primary);cursor:pointer}.loading[_ngcontent-%COMP%]{cursor:progress;animation:spin-animation 2s linear infinite}.table-row[_ngcontent-%COMP%]:hover:not(:first-child){background-color:var(--color-tertiary-container)}"]});let e=n;return e})();var Ht=[{path:"",loadComponent:()=>mt}];export{Ht as default};
