import{p as v}from"./chunk-2CLW3XS4.js";import{D as w}from"./chunk-UWS3ETMB.js";import{E as p,I as n,Mb as d,T as m,Yb as u,mb as P,n as l,q as a,v as f}from"./chunk-ZE3AX3HL.js";var A=(()=>{class o{constructor(){this.profilesUrl=u.apiUrl+u.trailerprofiles,this._service=n(w),this.websocketService=n(v),this.allProfiles=d(()=>this.profilesUrl,{defaultValue:[]}),this.selectedProfileId=m(0),this.fetchSelectedProfileResource=d(()=>{if(!(this.selectedProfileId()<=0||this.allProfiles.value().findIndex(e=>e.id===this.selectedProfileId())!==-1))return this.profilesUrl+this.selectedProfileId()}),this.selectedProfile=P(()=>{let r=this.selectedProfileId();if(r<=0)return;let e=this.allProfiles.value().find(t=>t.id===r);return e||this.fetchSelectedProfileResource.value()})}profileExists(r){return this.allProfiles.value().some(t=>t.id===r)?!0:(this.websocketService.showToast(`Profile with ID '${r}' does not exist.`,"error"),!1)}createProfile(r){return!r||!r.customfilter.filter_name?(this.websocketService.showToast("Profile name is required","error"),console.error("Profile creation failed: Name is required"),l(null)):this._service.createTrailerProfileApiV1TrailerprofilesPost({body:r}).pipe(a(e=>(this.allProfiles.reload(),this.selectedProfileId.set(e.id),this.websocketService.showToast(`Profile '${e.customfilter.filter_name}' created successfully!`,"success"),e.id)),f(e=>{let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to create profile:",t),this.websocketService.showToast(t,"error"),l(null)}))}updateProfile(r){return!r||!r.customfilter.filter_name?(this.websocketService.showToast("Profile name is required","error"),console.error("Profile update failed: Name is required"),l(!1)):this._service.updateTrailerProfileApiV1TrailerprofilesTrailerprofileIdPut({trailerprofile_id:r.id,body:r}).pipe(a(e=>(this.allProfiles.reload(),this.websocketService.showToast(`Profile '${e.customfilter.filter_name}' updated successfully!`,"success"),!0)),f(e=>{let t="An unknown error occurred!";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to update profile:",t),this.websocketService.showToast(t,"error"),l(!1)}))}updateSetting(r,e){let t=this.selectedProfileId();if(t<=0)throw new Error("No profile selected");this._service.updateTrailerProfileSettingApiV1TrailerprofilesTrailerprofileIdSettingPost({trailerprofile_id:t,body:{key:r,value:e}}).subscribe({next:i=>{this.allProfiles.update(c=>{let h=c.findIndex(b=>b.id===i.id);return h!==-1?(c[h]=i,[...c]):[...c,i]});let s=r.charAt(0).toUpperCase()+r.replaceAll("_"," ").slice(1);this.websocketService.showToast(`${s} set to '${e}' successfully!`,"success")},error:i=>{let s="An unknown error occurred!";i.error instanceof ErrorEvent?s=`Error: ${i.error.message}`:s=`Error: ${i.status} ${i.error.detail}`,console.error("Failed to update profile setting:",s),this.websocketService.showToast(s,"error")}})}deleteProfile(r){if(r<=0)throw new Error("Invalid profile ID");this._service.deleteTrailerProfileApiV1TrailerprofilesTrailerprofileIdDelete({trailerprofile_id:r}).subscribe({next:()=>{this.selectedProfileId.set(0),this.allProfiles.reload(),this.websocketService.showToast("Profile deleted successfully!","success")},error:e=>{let t="An unknown error occurred!";e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to delete profile:",t),this.websocketService.showToast(t,"error")}})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{A as a};
