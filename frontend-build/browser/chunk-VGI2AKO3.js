import{a as P,b as M,c as ce,d as me,e as x,f as E,g as D,h as L,i as v,j as ue}from"./chunk-GH5DZXSF.js";import{a as z,b as g,c as K,d as J,h as W,i as X,m as Y,n as ee,o as te,p as ie,q as ne,r as oe,s as re,v as le,x as ae,y as se,z as de}from"./chunk-Z5MLSR7V.js";import{a as pe}from"./chunk-D6DKQXGF.js";import{Aa as Z,Ba as s,Fa as j,Ga as H,H as A,J as p,K as _,L as y,La as u,Na as V,Wa as f,X as c,Y as $,ba as b,eb as q,fb as R,ib as F,jb as U,ka as T,la as S,ma as I,na as O,oa as w,pa as k,qa as d,ra as r,sa as l,ta as m,ua as B,va as G,wa as Q,ya as N,za as C}from"./chunk-W2THRVT5.js";var _e=(()=>{let o=class o{constructor(){this.link=F.required()}openExternalLink(e){e?.preventDefault(),window.open(this.link(),"_blank","noopener")}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=b({type:o,selectors:[["help-link-icon"]],inputs:{link:[1,"link"]},decls:2,vars:0,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960","title","Open documentation",3,"click"],["d",`M483.93-236q18.07 0 30.57-12.43t12.5-30.5q0-18.07-12.43-30.57t-30.5-12.5q-18.07 0-30.57 12.43t-12.5 30.5q0 18.07 12.43 30.57t30.5 
      12.5ZM443-389h71q0-28.32 6-51.16Q526-463 563-494q31-25 44.5-50.92t13.5-57.99q0-56.51-36.85-89.3T486.47-725q-54.47 0-93.97 
      26.5T336-625l63 24q9-27 30.5-44t53.5-17q32 0 53 17.5t21 45.5q0 22-13.71 41.5Q529.57-538 505-517q-33 28-47.5 54T443-389Zm36.54 
      325q-85.18 0-161.02-33.02t-132.16-89.34q-56.32-56.32-89.34-132.29T64-480q0-86.27 33.08-162.15 33.08-75.88 89.68-132.47 56.61-56.59 
      132.22-88.99Q394.59-896 479.56-896q86.33 0 162.51 32.39 76.18 32.4 132.56 89Q831-718 863.5-641.96q32.5 76.04 32.5 162.5 0 
      85.46-32.39 160.8-32.4 75.34-88.99 131.92Q718.03-130.16 642-97.08 565.98-64 479.54-64Z`]],template:function(t,a){t&1&&(y(),B(0,"svg",0),Z("click",function(fe){return a.openExternalLink(fe)}),Q(1,"path",1),G())},styles:["[_nghost-%COMP%]{display:contents}svg[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;margin:0 .5rem;fill:var(--color-info);cursor:help}"],changeDetection:0});let n=o;return n})();var Ce=["customFilterDialog"];function he(n,o){n&1&&m(0,"app-load-indicator",1)}function ve(n,o){if(n&1&&(r(0,"option",17),u(1),l()),n&2){let i=o.$implicit,e=s(3);d("value",i),c(),V(" ",e.displayTitle(i)," ")}}function ye(n,o){if(n&1&&(r(0,"option",17),u(1),l()),n&2){let i=o.$implicit,e=s(3);d("value",i),c(),V(" ",e.displayTitle(i)," ")}}function Fe(n,o){if(n&1&&m(0,"input",19),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function xe(n,o){if(n&1&&m(0,"input",20),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function be(n,o){if(n&1&&(m(0,"input",26),r(1,"span"),u(2," days"),l()),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function Te(n,o){if(n&1&&m(0,"input",21),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function Se(n,o){if(n&1&&(r(0,"select",22)(1,"option",27),u(2,"True"),l(),r(3,"option",28),u(4,"False"),l()()),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function we(n,o){if(n&1){let i=N();r(0,"div",9)(1,"div",5)(2,"select",15),C("change",function(t){let a=p(i).$index,h=s(2);return _(h.onFilterByChange(t,a))}),r(3,"option",16),u(4,"Select Filter By"),l(),w(5,ve,2,2,"option",17,O),l()(),r(7,"div",5)(8,"select",18),C("change",function(t){let a=p(i).$index,h=s(2);return _(h.onFilterConditionChange(t,a))}),r(9,"option",16),u(10,"Select Condition"),l(),w(11,ye,2,2,"option",17,O),l()(),r(13,"div",5),T(14,Fe,1,2,"input",19)(15,xe,1,2,"input",20)(16,be,3,2)(17,Te,1,2,"input",21)(18,Se,5,2,"select",22),l(),r(19,"button",23),C("click",function(){let t=p(i).$index,a=s(2);return _(a.removeFilter(t))}),y(),r(20,"svg",24),m(21,"path",25),l()()()}if(n&2){let i=o.$index,e=s(2);d("formGroupName",i),c(2),d("id",f("filter_by_",i)),c(3),k(e.filterKeys),c(3),d("id",f("filter_condition_",i)),c(3),k(e.filterConditions[i]),c(3),S(e.filterValueTypes[i]==="string"?14:e.filterValueTypes[i]==="number"?15:e.filterValueTypes[i]==="number_days"?16:e.filterValueTypes[i]==="date"?17:e.filterValueTypes[i]==="boolean"?18:-1)}}function ke(n,o){if(n&1&&(r(0,"button",13),u(1),l()),n&2){let i=s(2);d("disabled",i.customFilterForm.pristine||i.customFilterForm.invalid||i.submitting),c(),V(" ",i.customFilter()?"Update":"Create"," ")}}function Ve(n,o){n&1&&(r(0,"div",14),y(),r(1,"svg",29)(2,"circle",30),m(3,"animate",31),l(),r(4,"circle",32),m(5,"animate",33),l(),r(6,"circle",34),m(7,"animate",35),l()()())}function Me(n,o){if(n&1){let i=N();r(0,"form",3),C("ngSubmit",function(){p(i);let t=s();return _(t.onSubmit())})("click",function(t){return p(i),_(t.stopPropagation())}),m(1,"help-link-icon",4),r(2,"div",5)(3,"label",6),u(4,"Label"),l(),m(5,"input",7),l(),r(6,"div",8),w(7,we,22,6,"div",9,I),r(9,"button",10),C("click",function(){p(i);let t=s();return _(t.addFilter())}),u(10,"Add Filter"),l()(),r(11,"div",11)(12,"button",12),C("click",function(){p(i);let t=s();return _(t.closeDialog(-1))}),u(13,"Cancel"),l(),T(14,ke,2,2,"button",13)(15,Ve,8,0,"div",14),l()()}if(n&2){let i=s();d("formGroup",i.customFilterForm),c(),d("link",i.helpLink),c(6),k(i.filters.controls),c(7),S(i.submitting?15:14)}}var Ze=(()=>{let o=class o{constructor(){this.fb=A(ae),this.helpLink="https://nandyalu.github.io/trailarr/user-guide/settings/profiles/filters/",this.filterType=F.required(),this.filterTypeValue=q(()=>{let e=this.filterType().toUpperCase();return e=="MOVIES"?v.MOVIES:e=="SERIES"?v.SERIES:e=="TRAILER"?v.TRAILER:v.HOME}),this.customFilter=F(null),this.dialogClosed=new $,this.isLoading=!0,this.customfilterService=A(ue),this.computedSignal=q(()=>{let e=this.customFilter();return this.initForm(e),!0}),this.boolFilterConditions=Object.values(P),this.dateFilterConditions=Object.values(M),this.numberFilterConditions=Object.values(ce),this.stringFilterConditions=Object.values(me),this.filterConditions=[],this.filterValueTypes=[],this.filterKeys=x.concat(E,D,L).sort(),this.viewForOptions=Object.values(v),this.customFilterDialog=U.required("customFilterDialog"),this.submitting=!1,R(()=>{this.initForm(this.customFilter())})}ngAfterViewInit(){this.customFilterDialog().nativeElement.showModal()}closeDialog(e){this.customFilterDialog().nativeElement.close(),this.dialogClosed.emit(e),this.filters.clear(),this.addFilter(),this.customFilterForm.reset()}displayTitle(e){return e.toLowerCase().replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}initForm(e){let t=this.fb.group({id:[e?e.id:null],filter_type:[e?e.filter_type:this.filterTypeValue(),g.required],filter_name:[e?e.filter_name:"",[g.required,g.maxLength(100)]],filters:this.fb.array([],g.required)});return this.customFilterForm=t,e&&e.filters&&e.filters.length?e.filters.forEach(a=>{this.addFilter(a)}):this.addFilter(),this.isLoading=!1,t}get filters(){return this.customFilterForm.get("filters")}createFilter(e){return this.fb.group({id:[e?e.id:null],filter_by:[e?e.filter_by:"",g.required],filter_condition:[e?e.filter_condition:"",g.required],filter_value:[e?e.filter_value:"",g.required],customfilter_id:[e?e.customfilter_id:null]})}getFilterConditions(e){return x.includes(e)?this.boolFilterConditions:E.includes(e)?this.dateFilterConditions:D.includes(e)?this.numberFilterConditions:L.includes(e)?this.stringFilterConditions:[]}getFilterValueType(e,t){return x.includes(e)?"boolean":E.includes(e)?t===M.IN_THE_LAST||t===M.NOT_IN_THE_LAST?"number_days":"date":D.includes(e)?"number":"string"}addFilter(e){e&&e.filter_by?(this.filterConditions.push(this.getFilterConditions(e.filter_by)),this.filterValueTypes.push(this.getFilterValueType(e.filter_by,e.filter_condition))):(this.filterConditions.push([]),this.filterValueTypes.push("string")),this.filters.push(this.createFilter(e))}removeFilter(e){this.filterConditions.splice(e,1),this.filters.removeAt(e)}onFilterByChange(e,t){let a=this.filters.at(t).get("filter_by")?.value;this.filterConditions[t]=this.getFilterConditions(a),this.filterValueTypes[t]=this.getFilterValueType(a,""),this.filters.at(t).get("filter_condition")?.setValue(""),x.includes(a)&&this.filters.at(t).get("filter_condition")?.setValue(P.EQUALS),this.filters.at(t).get("filter_value")?.reset()}onFilterConditionChange(e,t){let a=this.filters.at(t).get("filter_by")?.value;if(e.target){let h=e.target.value;this.filterValueTypes[t]=this.getFilterValueType(a,h)}this.filters.at(t).get("filter_value")?.reset()}onSubmit(){if(!this.submitting)if(this.submitting=!0,this.customFilterForm.valid){let e=this.customFilterForm.value;e.filters.forEach(t=>{t.filter_value=t.filter_value.toString()}),this.customFilter()?.id?this.customfilterService.update(e).subscribe(t=>{this.closeDialog(t.id),this.submitting=!1}):this.customfilterService.create(e).subscribe(t=>{this.closeDialog(t.id),this.submitting=!1})}else console.log("Form is invalid"),this.customFilterForm.markAllAsTouched(),this.submitting=!1}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=b({type:o,selectors:[["app-add-filter-dialog"]],viewQuery:function(t,a){t&1&&j(a.customFilterDialog,Ce,5),t&2&&H()},inputs:{filterType:[1,"filterType"],customFilter:[1,"customFilter"]},outputs:{dialogClosed:"dialogClosed"},decls:4,vars:1,consts:[["customFilterDialog",""],[1,"center"],[3,"formGroup"],[3,"ngSubmit","click","formGroup"],[1,"top-right",3,"link"],[1,"form-group"],["for","filter_name"],["id","filter_name","type","text","maxlength","100","formControlName","filter_name"],["formArrayName","filters",1,"filters-container"],[1,"filter-group",3,"formGroupName"],["type","button",1,"secondary",3,"click"],[1,"buttons-row"],["type","button",1,"danger",3,"click"],["type","submit",1,"primary",3,"disabled"],["title","Submitting form data"],["formControlName","filter_by",3,"change","id"],["value","","disabled",""],[3,"value"],["formControlName","filter_condition",3,"change","id"],["type","text","formControlName","filter_value",3,"id"],["type","number","formControlName","filter_value",3,"id"],["type","date","formControlName","filter_value",3,"id"],["formControlName","filter_value",3,"id"],["type","button",1,"danger","icononly-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M253-99q-38.21 0-65.11-26.6Q161-152.2 161-190v-552h-58v-91h228v-47h297v47h228v91h-58v552q0 37.18-27.21 64.09Q743.59-99 706-99H253Zm453-643H253v552h453v-552ZM357-268h74v-398h-74v398Zm173 0h75v-398h-75v398ZM253-742v552-552Z"],["type","number","placeholder","days","formControlName","filter_value",3,"id"],["value","true"],["value","false"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 200",1,"icon-loading"],["stroke-width","14","r","15","cx","40","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.4"],["stroke-width","14","r","15","cx","100","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.2"],["stroke-width","14","r","15","cx","160","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","0"]],template:function(t,a){t&1&&(r(0,"dialog",null,0),T(2,he,1,0,"app-load-indicator",1)(3,Me,16,3,"form",2),l()),t&2&&(c(2),S(a.isLoading?2:3))},dependencies:[se,W,oe,re,z,X,ne,K,J,le,_e,pe,de,Y,ie,ee,te],styles:["[_nghost-%COMP%]{display:contents}.center[_ngcontent-%COMP%]{margin:auto}form[_ngcontent-%COMP%]{padding:1rem;display:block flex;flex-direction:column;gap:1rem;position:relative}.top-right[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;display:block}label[_ngcontent-%COMP%]{display:block;margin-bottom:.4rem;font-weight:700}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.5rem;box-sizing:border-box}option[_ngcontent-%COMP%]{background-color:var(--color-surface-container-high)}.ng-touched.ng-invalid[_ngcontent-%COMP%]:not(form):not(div){border:2px solid var(--color-danger)}.error[_ngcontent-%COMP%]{color:var(--color-danger);font-size:.9rem;margin-top:.4rem}.filters-container[_ngcontent-%COMP%]{border-top:1px solid var(--color-outline);padding-top:1rem}.filter-group[_ngcontent-%COMP%]{display:block flex;flex-wrap:wrap;gap:1rem;align-items:center;border:1px solid var(--color-outline);border-radius:.5rem;padding:.5rem;margin-bottom:.75rem;background-color:var(--color-surface-container-high)}.filter-group[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:nth-child(3){flex:1;text-align:start}.danger[_ngcontent-%COMP%]{width:auto;height:auto}.danger[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-danger-text)}.buttons-row[_ngcontent-%COMP%]{display:block flex;align-items:center;justify-content:space-around}.icon-loading[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;fill:var(--color-on-surface)}"]});let n=o;return n})();export{_e as a,Ze as b};
