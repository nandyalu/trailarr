import{E as y,e as w,f as _,g as m,h as p,i as x,j as f}from"./chunk-ZE3AX3HL.js";var W="about";var I="connections",E="edit",$="home",j="logs",T="media",O="movies",M="profiles",v="series",P="settings",C="tasks",A="general",z="connectionId",B="mediaId",J="profileId";var g={url:"",deserializer:i=>JSON.parse(i.data),serializer:i=>JSON.stringify(i)},R="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",d=class i extends x{constructor(t,s){if(super(),this._socket=null,t instanceof m)this.destination=s,this.source=t;else{let e=this._config=Object.assign({},g);if(this._output=new p,typeof t=="string")e.url=t;else for(let a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);if(!e.WebSocketCtor&&WebSocket)e.WebSocketCtor=WebSocket;else if(!e.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new f}}lift(t){let s=new i(this._config,this.destination);return s.operator=t,s.source=this,s}_resetState(){this._socket=null,this.source||(this.destination=new f),this._output=new p}multiplex(t,s,e){let a=this;return new m(r=>{try{a.next(t())}catch(n){r.error(n)}let o=a.subscribe({next:n=>{try{e(n)&&r.next(n)}catch(c){r.error(c)}},error:n=>r.error(n),complete:()=>r.complete()});return()=>{try{a.next(s())}catch(n){r.error(n)}o.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:t,protocol:s,url:e,binaryType:a}=this._config,r=this._output,o=null;try{o=s?new t(e,s):new t(e),this._socket=o,a&&(this._socket.binaryType=a)}catch(c){r.error(c);return}let n=new w(()=>{this._socket=null,o&&o.readyState===1&&o.close()});o.onopen=c=>{let{_socket:h}=this;if(!h){o.close(),this._resetState();return}let{openObserver:k}=this._config;k&&k.next(c);let b=this.destination;this.destination=_.create(u=>{if(o.readyState===1)try{let{serializer:l}=this._config;o.send(l(u))}catch(l){this.destination.error(l)}},u=>{let{closingObserver:l}=this._config;l&&l.next(void 0),u&&u.code?o.close(u.code,u.reason):r.error(new TypeError(R)),this._resetState()},()=>{let{closingObserver:u}=this._config;u&&u.next(void 0),o.close(),this._resetState()}),b&&b instanceof f&&n.add(b.subscribe(this.destination))},o.onerror=c=>{this._resetState(),r.error(c)},o.onclose=c=>{o===this._socket&&this._resetState();let{closeObserver:h}=this._config;h&&h.next(c),c.wasClean?r.complete():r.error(c)},o.onmessage=c=>{try{let{deserializer:h}=this._config;r.next(h(c))}catch(h){r.error(h)}}}_subscribe(t){let{source:s}=this;return s?s.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add(()=>{let{_socket:e}=this;this._output.observers.length===0&&(e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState())}),t)}unsubscribe(){let{_socket:t}=this;t&&(t.readyState===1||t.readyState===0)&&t.close(),this._resetState(),super.unsubscribe()}};function S(i){return new d(i)}var tt=(()=>{class i{constructor(){this.toastMessage=new p,this.connect()}connect(){if(!this.socket$||this.socket$.closed){let s=Math.floor(Math.random()*1e6),e=window.location.protocol==="https:"?"wss:":"ws:",a=window.location.hostname,r=window.location.port?`:${window.location.port}`:"",o=`${e}//${a}${r}/ws/${s}`;this.socket$=S(o),this.websocketSubscription=this.socket$.subscribe({next:n=>{this.toastMessage.next(n)},error:n=>{console.error("WebSocket error:",n)},complete:()=>{console.log("WebSocket connection closed")}})}return this.socket$.asObservable()}showToast(s,e="Success"){this.toastMessage.next({message:s,type:e,reload:"none"})}close(){this.websocketSubscription&&this.websocketSubscription.unsubscribe(),this.socket$.complete()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{W as a,I as b,E as c,$ as d,j as e,T as f,O as g,M as h,v as i,P as j,C as k,A as l,z as m,B as n,J as o,tt as p};
