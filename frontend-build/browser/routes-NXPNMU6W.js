import{a as pe}from"./chunk-WOA3RAU4.js";import{a as J}from"./chunk-2XBANTUS.js";import{a as me,b as de}from"./chunk-NAMTLW4N.js";import{b as K,e as X,f as Y,h as ee,i as te,j as oe,k as ne,m as ie,n as re,o as le,p as ae,u as se,v as ce,z as M}from"./chunk-JVTE5FXR.js";import{a as q,b as ge}from"./chunk-3OXZ5NJK.js";import{$a as x,Ba as V,Ca as w,Da as y,E,Ea as C,Fa as i,Fb as B,Ga as n,Ha as s,I as p,L as Z,M as k,Ma as I,N as g,Na as L,O as D,Pa as u,Pb as z,Q as F,Rb as W,T as v,U as Q,Wa as R,Ya as j,Za as m,_a as h,ba as l,bb as U,cb as $,db as G,ha as N,ib as b,nb as O,ob as P,rb as H,w as S,x as T,xc as A,ya as _,za as f}from"./chunk-IMRADBSH.js";var ue=(()=>{class t{constructor(){this.http=p(z),this.logsUrl=`${q.apiUrl}${q.logs}`,this.downloadLogs=()=>this.http.get(this.logsUrl+"download",{responseType:"blob"}),this.getLogs=()=>this.http.get(this.logsUrl),this.getRawLogs=()=>this.http.get(this.logsUrl+"raw")}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var fe=(t,a)=>a.id;function Ce(t,a){if(t&1&&(i(0,"option",6),m(1),O(2,"titlecase"),n()),t&2){let e=a.$implicit,o=u();C("value",e)("selected",o.selectedLogLevel()===e),l(),h(P(2,3,e))}}function Le(t,a){t&1&&s(0,"app-load-indicator",11)}function Me(t,a){t&1&&(g(),i(0,"svg",17),s(1,"path",21),n())}function we(t,a){t&1&&(g(),i(0,"svg",17),s(1,"path",22),n())}function ye(t,a){t&1&&(g(),i(0,"svg",17),s(1,"path",23),n())}function xe(t,a){t&1&&(g(),i(0,"svg",17),s(1,"path",24),n())}function be(t,a){t&1&&(g(),i(0,"svg",17),s(1,"path",25),n())}function Oe(t,a){if(t&1&&(i(0,"details",20)(1,"summary")(2,"small"),m(3,"Exception Details (click to show/hide)"),n()(),i(4,"pre",26),m(5),n()()),t&2){let e=u().$implicit;l(5),h(e.traceback)}}function Pe(t,a){if(t&1&&(i(0,"div",14)(1,"details")(2,"summary")(3,"p",15)(4,"i",16),_(5,Me,2,0,":svg:svg",17)(6,we,2,0,":svg:svg",17)(7,ye,2,0,":svg:svg",17)(8,xe,2,0,":svg:svg",17)(9,be,2,0,":svg:svg",17),n(),i(10,"strong"),m(11),n(),m(12),n(),i(13,"small",18),m(14),O(15,"timeago"),n()(),i(16,"p",19),m(17),n(),_(18,Oe,6,1,"details",20),n()()),t&2){let e=a.$implicit,o=u(2);l(3),j(b("logs-text ",e.level.toLowerCase())),C("title",b("",e.level.toLowerCase()," log")),l(2),f(e.level===o.logLevels.Info?5:e.level===o.logLevels.Debug?6:e.level===o.logLevels.Warning?7:e.level===o.logLevels.Error||e.level===o.logLevels.Exception||e.level===o.logLevels.Critical?8:9),l(6),x("",e.loggername,": "),l(),x("",e.message," "),l(2),h(P(15,11,e.created)),l(3),h(o.getRawLog(e)),l(),f(e.traceback?18:-1)}}function qe(t,a){if(t&1){let e=I();i(0,"div",13),L("nearEnd",function(){Z(e);let r=u();return k(r.loadMore())}),w(1,Pe,19,13,"div",14,fe),n()}if(t&2){let e=u();l(),y(e.filteredLogs())}}var ve=(()=>{class t{constructor(){this.destroyRef=p(F),this.logsService=p(ue),this.route=p(A),this.title="Logs",this.logLevels=M,this.allLogLevels=Object.values(M),this.searchForm=new te,this.displayCount=v(100),this.allLogs=W(()=>({url:this.logsService.logsUrl+"raw",method:"GET",params:{level:this.selectedLogLevel().toUpperCase(),limit:this.limit()}}),{defaultValue:[]}),this.searchQuery=v(""),this.selectedLogLevel=v(M.Info),this.limit=v(1e3),this.filteredLogs=H(()=>{let e=this.searchQuery(),o=this.allLogs.value();return!e||e.length<3?o.slice(0,this.displayCount()):o.filter(r=>Object.values(r).map(he=>he?.toString()||"").join(" | ").toLowerCase().includes(e.toLowerCase()))}),this.resetDisplayCount=Q(()=>{this.searchQuery().length<3&&this.displayCount.set(100),this.selectedLogLevel(),this.displayCount.set(100)})}ngOnInit(){this.route.queryParams.subscribe(e=>{let o=e.filter;o&&(this.searchForm.setValue(o),this.searchQuery.set(o))}),this.searchForm.valueChanges.pipe(S(400),T(),J(this.destroyRef)).subscribe(e=>{this.searchQuery.set(e)})}getRawLog(e){return`${e.created}: [${e.level}|${e.filename}|${e.lineno}] ${e.loggername} ${e.message}`}downloadLogs(){let e=this.filteredLogs().map(d=>this.getRawLog(d)).join(`
`),o=new Blob([e],{type:"text/plain"}),r=window.URL.createObjectURL(o),c=document.createElement("a");c.href=r,c.download=`trailarr-logs-${new Date().toISOString()}.txt`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(r)}loadMore(){let e=this.displayCount();if(e>=this.allLogs.value().length){this.limit.update(o=>o+1e3);return}this.displayCount.set(e+30)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=N({type:t,selectors:[["app-logs"]],decls:15,vars:5,consts:[[1,"logs-container"],[1,"logssearch"],["title","Refresh",1,"icononly-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960",1,"refresh-icon"],["d","M343-107q-120-42-194.5-146.5T74-490q0-29 4-57.5T91-604l-57 33-37-62 185-107 106 184-63 36-54-92q-13 30-18.5 60.5T147-490q0 113 65.5 200T381-171l-38 64Zm291-516v-73h107q-47-60-115.5-93.5T480-823q-66 0-123.5 24T255-734l-38-65q54-45 121-71t142-26q85 0 160.5 33T774-769v-67h73v213H634ZM598-1 413-107l107-184 62 37-54 94q123-17 204.5-110.5T814-489q0-19-2.5-37.5T805-563h74q4 18 6 36.5t2 36.5q0 142-87 251.5T578-96l56 33-36 62Z"],["name","logs-type","id","logs-type-select",1,"logs-type-select",3,"ngModelChange","ngModel"],[3,"value","selected"],["id","searchForm",1,"logssearch-form"],["type","search","autocomplete","off","name","query","placeholder","Filter logs...","aria-label","filter logs",3,"formControl"],["title","Download Logs",1,"icononly-button",3,"click"],["d","M480-313 287-506l43-43 120 120v-371h60v371l120-120 43 43-193 193ZM220-160q-24 0-42-18t-18-42v-143h60v143h520v-143h60v143q0 24-18 42t-42 18H220Z"],[1,"center"],["appScrollNearEnd","",1,"logs-table"],["appScrollNearEnd","",1,"logs-table",3,"nearEnd"],[1,"logs-row"],[3,"title"],[1,"logs-icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],[1,"logs-dt"],[1,"logs-raw"],[1,"logs-details"],["d","M453-280h60v-240h-60v240Zm26.98-314q14.02 0 23.52-9.2T513-626q0-14.45-9.48-24.22-9.48-9.78-23.5-9.78t-23.52 9.78Q447-640.45 447-626q0 13.6 9.48 22.8 9.48 9.2 23.5 9.2Zm.29 514q-82.74 0-155.5-31.5Q252-143 197.5-197.5t-86-127.34Q80-397.68 80-480.5t31.5-155.66Q143-709 197.5-763t127.34-85.5Q397.68-880 480.5-880t155.66 31.5Q709-817 763-763t85.5 127Q880-563 880-480.27q0 82.74-31.5 155.5Q817-252 763-197.68q-54 54.31-127 86Q563-80 480.27-80Zm.23-60Q622-140 721-239.5t99-241Q820-622 721.19-721T480-820q-141 0-240.5 98.81T140-480q0 141 99.5 240.5t241 99.5Zm-.5-340Z"],["d","M320-242 80-482l242-242 43 43-199 199 197 197-43 43Zm318 2-43-43 199-199-197-197 43-43 240 240-242 242Z"],["d","m40-120 440-760 440 760H40Zm104-60h672L480-760 144-180Zm340.18-57q12.82 0 21.32-8.68 8.5-8.67 8.5-21.5 0-12.82-8.68-21.32-8.67-8.5-21.5-8.5-12.82 0-21.32 8.68-8.5 8.67-8.5 21.5 0 12.82 8.68 21.32 8.67 8.5 21.5 8.5ZM454-348h60v-224h-60v224Zm26-122Z"],["d","M479.91-120q-28.91 0-49.41-20.59-20.5-20.59-20.5-49.5t20.59-49.41q20.59-20.5 49.5-20.5t49.41 20.59q20.5 20.59 20.5 49.5t-20.59 49.41q-20.59 20.5-49.5 20.5ZM410-360v-480h140v480H410Z"],["d","M477.03-246Q493-246 504-257.03q11-11.03 11-27T503.97-311q-11.03-11-27-11T450-310.97q-11 11.03-11 27T450.03-257q11.03 11 27 11ZM444-394h57q0-31 10-50.5t34.72-44.22Q579-522 592-547.5t13-53.5q0-53-34-84t-91.52-31q-51.87 0-88.17 24.5Q355-667 338-624l53 22q14-28 36.2-42.5Q449.4-659 479-659q32 0 50.5 16t18.5 44.1q0 19.9-11 38.4T500-517q-37 35-46.5 60t-9.5 63ZM180-120q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h600q24 0 42 18t18 42v600q0 24-18 42t-42 18H180Zm0-60h600v-600H180v600Zm0-600v600-600Z"],[1,"logs-pre"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"div",1)(2,"i",2),L("click",function(){return r.allLogs.reload()}),g(),i(3,"svg",3),s(4,"path",4),n()(),D(),i(5,"select",5),G("ngModelChange",function(d){return $(r.selectedLogLevel,d)||(r.selectedLogLevel=d),d}),w(6,Ce,3,5,"option",6,V),n(),i(8,"form",7),s(9,"input",8),n(),i(10,"a",9),L("click",function(){return r.downloadLogs()}),g(),i(11,"svg",3),s(12,"path",10),n()()(),_(13,Le,1,0,"app-load-indicator",11)(14,qe,3,0,"div",12),n()),o&2&&(l(2),R("loading",r.allLogs.isLoading()),l(3),U("ngModel",r.selectedLogLevel),l(),y(r.allLogLevels),l(3),C("formControl",r.searchForm),l(4),f(r.allLogs.isLoading()&&r.allLogs.value().length===0?13:14))},dependencies:[se,ne,le,ae,K,re,X,Y,oe,ee,ge,ce,ie,pe,de,me,B],styles:[".logs-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.logssearch[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;width:auto;flex-grow:1;padding:1rem;background-color:var(--color-surface-container-low);position:sticky;top:76px;z-index:2;gap:.5rem}@media(width<765px){.logssearch[_ngcontent-%COMP%]{padding:.5rem;top:76px}}.refresh-icon[_ngcontent-%COMP%]{cursor:pointer;fill:var(--color-on-surface)}.loading[_ngcontent-%COMP%]{cursor:progress;animation:spin-animation 2s linear infinite}.logs-type-select[_ngcontent-%COMP%]{width:10rem;padding:.5rem;border:1px solid var(--color-outline);border-radius:.5rem;background-color:var(--color-surface-container-highest);color:var(--color-on-surface);font-size:1rem}.logs-type-select[_ngcontent-%COMP%]:focus{outline:var(--color-primary);border:1px solid var(--color-primary)}.logssearch-form[_ngcontent-%COMP%]{width:100%}.logssearch-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid var(--color-outline);border-radius:.5rem;margin:0;font-size:1rem;background-color:var(--color-surface-container-highest);color:var(--color-on-surface)}.logssearch-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:var(--color-primary);border:1px solid var(--color-primary)}.logs-table[_ngcontent-%COMP%]{padding:1rem}.logs-row[_ngcontent-%COMP%]{padding:10px;border-bottom:2px solid var(--color-outline-variant)}@media(width<765px){.logs-row[_ngcontent-%COMP%]{padding:0}}.logs-row[_ngcontent-%COMP%]   details[_ngcontent-%COMP%]{width:100%;list-style-position:outside}.logs-row[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{list-style-position:outside;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;cursor:pointer;position:relative}@media(width<765px){.logs-row[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{flex-direction:column;align-items:baseline;gap:0;margin-bottom:1rem}}summary[_ngcontent-%COMP%]   .logs-text[_ngcontent-%COMP%]{flex:1;margin-left:2rem}.logs-pre[_ngcontent-%COMP%]{text-wrap:auto;white-space:pre-wrap;word-break:break-word;margin:.5rem 0;padding:1rem;border-radius:1rem;background-color:var(--color-surface-container-highest)}.logs-icon[_ngcontent-%COMP%]{position:absolute;top:.75rem;left:0;font-size:0;z-index:0}.logs-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:1.5rem;fill:var(--color-outline)}summary[_ngcontent-%COMP%]   .debug[_ngcontent-%COMP%]{color:var(--color-info)}summary[_ngcontent-%COMP%]   .debug[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-info)}summary[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:var(--color-danger)}summary[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-danger)}summary[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--color-warning)}summary[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-warning)}"],changeDetection:0})}}return t})();var Xe=[{path:"",loadComponent:()=>ve}];export{Xe as default};
