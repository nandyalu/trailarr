import{a as Y}from"./chunk-5NBK76TM.js";import{e as X,p as tt}from"./chunk-2CLW3XS4.js";import{a as et}from"./chunk-ZGO7C4B7.js";import{A as Z,Aa as i,Ba as n,Ca as d,E as B,Ha as G,I as g,Ia as W,Ka as h,Kb as J,L as R,M as H,N as T,O as N,Rb as K,Ua as o,Va as l,Yb as y,a as b,b as P,ba as s,eb as z,fb as E,g as D,ha as V,ib as c,jb as x,ka as j,kb as k,q as f,t as F,ta as _,ua as v,x as U,xa as q,ya as O,za as Q,zb as A}from"./chunk-ZE3AX3HL.js";var at=1e3,$=60*at,I=60*$,nt=24*I,ot=(()=>{class e{transform(t,a="Invalid date"){return t?F(1e3).pipe(Z(0),f(()=>this.getTimeDifferenceString(t,a)),U()):new D(r=>{r.next(a),r.complete()})}getTimeDifferenceString(t,a="Invalid date"){if(!t)return a;let r=new Date(t);if(isNaN(r.getTime()))return console.log("Invalid date in TimediffPipe:",t),a;let u=new Date().getTime()-r.getTime(),C=u<0?"from now":"ago";u=Math.abs(u);let S=Math.floor(u/nt);if(S>0)return`${S} day${S!==1?"s":""} ${C}`;let w=Math.floor(u%nt/I);if(w>0)return`${w} hour${w!==1?"s":""} ${C}`;let M=Math.floor(u%I/$);if(M>0)return`${M} minute${M!==1?"s":""} ${C}`;let L=Math.floor(u%$/at);return`${L} second${L!==1?"s":""} ${C}`}static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275pipe=j({name:"timediff",type:e,pure:!1})}}return e})();var rt=(()=>{class e{constructor(){this.http=g(J),this.tasksUrl=y.apiUrl+y.tasks,this.schedulesUrl=this.tasksUrl+"schedules",this.queueUrl=this.tasksUrl+"queue"}convertTime(t){let a=[{unit:"second",value:60},{unit:"minute",value:60},{unit:"hour",value:24},{unit:"day",value:7}];for(let{unit:r,value:p}of a){if(t<p)return`${t} ${r}${t===1?"":"s"}`;t=Math.floor(t/p)}return`${t} ${t===1?"week":"weeks"}`}convertDate(t){return t?new Date(t+"Z"):null}formatDuration(t){if(t<1)return"00:00:00";let a=Math.floor(t/3600).toString().padStart(2,"0"),r=Math.floor(t%3600/60).toString().padStart(2,"0"),p=(t%60).toString().padStart(2,"0");return`${a}:${r}:${p}`}getScheduledTasks(){return this.http.get(this.schedulesUrl).pipe(f(t=>Object.entries(t).map(([a,r])=>P(b({id:a},r),{interval:this.convertTime(r.interval),last_run_duration:this.formatDuration(r.last_run_duration)}))))}getQueuedTasks(){return this.http.get(this.queueUrl).pipe(f(t=>Object.entries(t).map(([a,r])=>P(b({id:a},r),{duration:this.formatDuration(r.duration)}))))}runScheduledTask(t){return this.http.get(this.tasksUrl+"run/"+t)}static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275prov=B({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var mt=e=>["/",e],dt=e=>({filter:e}),st=(e,m)=>m.id;function ct(e,m){e&1&&d(0,"app-load-indicator",2)}function pt(e,m){if(e&1){let t=G();i(0,"td",11),W("click",function(){R(t);let r=h().$implicit,p=h(2);return r.last_run_status="Running",H(p.runTask(r.task_id))}),T(),i(1,"svg",12),d(2,"path",13),n()()}}function ut(e,m){e&1&&(i(0,"td",10),T(),i(1,"svg",14),d(2,"path",15),n()())}function ht(e,m){if(e&1&&(i(0,"tr",8)(1,"td",7),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),c(7,"timediff"),c(8,"async"),n(),i(9,"td"),o(10),n(),i(11,"td"),o(12),n(),i(13,"td"),o(14),c(15,"timediff"),c(16,"async"),n(),_(17,pt,3,0,"td",9),_(18,ut,3,0,"td",10),n()),e&2){let t=m.$implicit;s(2),l(t.name),s(2),l(t.interval),s(2),l(x(8,11,k(7,8,t.last_run_start,"Not run yet"))),s(4),l(t.last_run_status),s(2),l(t.last_run_duration),s(2),l(x(16,16,k(15,13,t.next_run,"Not scheduled"))),s(3),v(t.last_run_status.toLowerCase()!="running"?17:-1),s(),v(t.last_run_status.toLowerCase()=="running"?18:-1)}}function ft(e,m){if(e&1&&(i(0,"div",3)(1,"table",5)(2,"tr",6)(3,"th",7),o(4,"Name"),n(),i(5,"th"),o(6,"Interval"),n(),i(7,"th"),o(8,"Last Run"),n(),i(9,"th"),o(10,"Last Run Status"),n(),i(11,"th"),o(12,"Last Run Duration"),n(),i(13,"th"),o(14,"Next Run"),n(),d(15,"th"),n(),q(16,ht,19,18,"tr",8,st),n()()),e&2){let t=h();s(16),O(t.scheduledTasks)}}function gt(e,m){e&1&&d(0,"app-load-indicator",2)}function _t(e,m){if(e&1&&(i(0,"tr",8)(1,"td",16)(2,"span"),o(3),n(),i(4,"i",17),T(),i(5,"svg",18),d(6,"path",19),n()()(),N(),i(7,"td"),o(8),n(),i(9,"td"),o(10),c(11,"timediff"),c(12,"async"),n(),i(13,"td"),o(14),c(15,"timediff"),c(16,"async"),n(),i(17,"td"),o(18),n()()),e&2){let t=m.$implicit,a=h(2);s(3),l(t.name),s(),Q("routerLink",E(17,mt,a.RouteLogs))("queryParams",E(19,dt,t.trace_id)),s(4),l(t.status),s(2),l(x(12,10,k(11,7,t.started,"Pending"))),s(4),l(x(16,15,k(15,12,t.finished,"-"))),s(4),l(t.duration)}}function vt(e,m){if(e&1&&(i(0,"div",4)(1,"table",5)(2,"tr",6)(3,"th",7),o(4,"Name"),n(),i(5,"th"),o(6,"Status"),n(),i(7,"th"),o(8,"Started"),n(),i(9,"th"),o(10,"Finished"),n(),i(11,"th"),o(12,"Duration"),n()(),q(13,_t,19,21,"tr",8,st),n()()),e&2){let t=h();s(13),O(t.queuedTasks)}}var lt=(()=>{class e{constructor(){this.tasksService=g(rt),this.websocketService=g(tt),this.scheduledTasks=[],this.queuedTasks=[],this.isLoading1=!0,this.isLoading2=!0,this.RouteLogs=X,this.websocketService.toastMessage.pipe(Y()).subscribe(t=>{t.reload?.includes("tasks")&&this.refreshTaskData()})}ngOnInit(){this.refreshTaskData()}refreshTaskData(){console.log("Refreshing task data"),this.tasksService.getScheduledTasks().subscribe(t=>{this.scheduledTasks=t,this.isLoading1=!1}),this.tasksService.getQueuedTasks().subscribe(t=>{this.queuedTasks=t,this.isLoading2=!1})}runTask(t){this.tasksService.runScheduledTask(t).subscribe(a=>{console.log(a)})}static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275cmp=V({type:e,selectors:[["app-tasks"]],features:[z([])],decls:11,vars:2,consts:[[1,"tasks-container"],[1,"text-heading"],[1,"center"],[1,"table-container"],[1,"table-container","last-table"],[1,"tasks-table"],[1,"table-row","header"],[1,"name"],[1,"table-row"],["title","Run task now"],["title","Task is running"],["title","Run task now",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M382-306.67 653.33-480 382-653.33v346.66ZM480-80q-82.33 0-155.33-31.5-73-31.5-127.34-85.83Q143-251.67 111.5-324.67T80-480q0-83 31.5-156t85.83-127q54.34-54 127.34-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 82.33-31.5 155.33-31.5 73-85.5 127.34Q709-143 636-111.5T480-80Z"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960",1,"loading"],["d","M343-107q-120-42-194.5-146.5T74-490q0-29 4-57.5T91-604l-57 33-37-62 185-107 106 184-63 36-54-92q-13 30-18.5 60.5T147-490q0 113 65.5 200T381-171l-38 64Zm291-516v-73h107q-47-60-115.5-93.5T480-823q-66 0-123.5 24T255-734l-38-65q54-45 121-71t142-26q85 0 160.5 33T774-769v-67h73v213H634ZM598-1 413-107l107-184 62 37-54 94q123-17 204.5-110.5T814-489q0-19-2.5-37.5T805-563h74q4 18 6 36.5t2 36.5q0 142-87 251.5T578-96l56 33-36 62Z"],[1,"name","queue-name"],["title","View Logs",3,"routerLink","queryParams"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960",1,"icon"],["d","M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1),o(2,"Scheduled"),n(),d(3,"hr"),_(4,ct,1,0,"app-load-indicator",2)(5,ft,18,0,"div",3),i(6,"div",1),o(7,"Queue"),n(),d(8,"hr"),_(9,gt,1,0,"app-load-indicator",2)(10,vt,15,0,"div",4),n()),a&2&&(s(4),v(r.isLoading1?4:5),s(5),v(r.isLoading1?9:10))},dependencies:[et,K,A,ot],styles:[".tasks-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1rem}@media(width<765px){.tasks-container[_ngcontent-%COMP%]{padding:.5rem}}.text-heading[_ngcontent-%COMP%]{margin-top:1rem;text-align:left;font-size:2rem}.center[_ngcontent-%COMP%]{margin:auto}.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto;min-height:25%;-webkit-overflow-scrolling:touch;margin-top:.5rem;margin-bottom:2rem}.last-table[_ngcontent-%COMP%]{margin-bottom:0}.tasks-table[_ngcontent-%COMP%]{width:100%;max-width:100%;white-space:nowrap;border-collapse:collapse}.tasks-table[_ngcontent-%COMP%]   .table-row[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-outline);white-space:nowrap;text-align:left}.tasks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tasks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem .5rem}.tasks-table[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-weight:700;border-bottom:2px solid var(--color-outline)}.tasks-table[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:100%}.tasks-table[_ngcontent-%COMP%]   .queue-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.tasks-table[_ngcontent-%COMP%]   .queue-name[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:contents}.tasks-table[_ngcontent-%COMP%]   .queue-name[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin:0;padding:0;width:1rem;height:1rem;fill:var(--color-primary);cursor:pointer}.table-row[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin:0 .5rem;width:1rem;fill:var(--color-primary);cursor:pointer}.loading[_ngcontent-%COMP%]{cursor:progress;animation:spin-animation 2s linear infinite}.table-row[_ngcontent-%COMP%]:hover:not(:first-child){background-color:var(--color-tertiary-container)}"]})}}return e})();var Rt=[{path:"",loadComponent:()=>lt}];export{Rt as default};
