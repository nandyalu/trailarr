import{a as C}from"./chunk-KFIKQOQP.js";import{B as p,C as h,D as a,E,F as I,G as A,H as L,J as U}from"./chunk-I3EQXGMR.js";import{a as O}from"./chunk-EWLZ4Y2T.js";import{Ac as x,Bc as w,_ as b,a as D,b as _,c as F,da as y,gc as m,p as c,sa as l,v as $,vc as M,yc as v}from"./chunk-77FKYVFO.js";function j(s){let t=Math.floor(s/60),r=Math.floor(s%60);return t===0?`${r}m`:r===0?`${t}h`:`${t}h ${r}m`}function z(s){let t=Math.floor(s/3600),r=Math.floor(s%3600/60),e=Math.floor(s%60);return t===0?`${r}m ${e}s`:`${t}h ${r}m ${e}s`}function G(s){let t=Date.now();if(s<t||(s-=t,s<0))return"0 seconds";let r=Math.floor(s/36e5),e=Math.floor(s%36e5/6e4),i=Math.floor(s%6e4/1e3);return r===0&&e===0&&i===0?"0 seconds":r===0&&e===0?`${i} seconds`:r===0?`${e} minutes ${i} seconds`:`${r} hours ${e} minutes ${i} seconds`}var J=(s,t)=>s===t||JSON.stringify(s)===JSON.stringify(t),N=new Map;function f(s=0){return function(t,r,e){let i=e.value;e.value=function(...n){let o=`${r.toString()}:${JSON.stringify(n)}`;if(N.has(o)){let S=N.get(o);if(s>0&&Date.now()-S.timestamp>s)N.delete(o);else return S.value}let g=i.apply(this,n);return N.set(o,{value:g,timestamp:Date.now()}),g}}}function P(s){if(s===0)return"0 B";let t=1024,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],e=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,e)).toFixed(2))+" "+r[e]}var u=class{static parseDate(t){return new Date(t)}static parseNumber(t){return parseFloat(t)}static getDaysAgo(t){let r=new Date;return r.setDate(r.getDate()-t),r}};c([f()],u,"parseDate",null);c([f()],u,"parseNumber",null);c([f()],u,"getDaysAgo",null);var d=class{static applyBooleanFilter(t,r){return t===r}static applyNumberFilter(t,r,e){switch(e){case h.GREATER_THAN:return t>r;case h.GREATER_THAN_EQUAL:return t>=r;case h.LESS_THAN:return t<r;case h.LESS_THAN_EQUAL:return t<=r;case h.EQUALS:return t===r;case h.NOT_EQUALS:return t!==r;default:return!0}}static applyDateFilter(t,r,e,i){switch(e){case p.IS_AFTER:return t>r;case p.IS_BEFORE:return t<r;case p.IN_THE_LAST:return i?t>i:!1;case p.NOT_IN_THE_LAST:return i?t<i:!1;case p.EQUALS:return t.toDateString()===r.toDateString();case p.NOT_EQUALS:return t.toDateString()!==r.toDateString();default:return!0}}static applyStringFilter(t,r,e){switch(e){case a.CONTAINS:return t.includes(r);case a.NOT_CONTAINS:return!t.includes(r);case a.EQUALS:return t===r;case a.NOT_EQUALS:return t!==r;case a.STARTS_WITH:return t.startsWith(r);case a.NOT_STARTS_WITH:return!t.startsWith(r);case a.ENDS_WITH:return t.endsWith(r);case a.NOT_ENDS_WITH:return!t.endsWith(r);case a.IS_EMPTY:return t==="";case a.IS_NOT_EMPTY:return t!=="";default:return!0}}};c([f()],d,"applyBooleanFilter",null);c([f()],d,"applyNumberFilter",null);c([f()],d,"applyDateFilter",null);function W(s,t){let{filter_by:r,filter_value:e,filter_condition:i}=s,n=t[r];if(E.includes(r)){let o=e.toLowerCase()==="true";return d.applyBooleanFilter(n,o)}if(I.includes(r)){let o=u.parseDate(n),g=u.parseDate(e),S=parseInt(e),k=isNaN(S)?void 0:u.getDaysAgo(S);return d.applyDateFilter(o,g,i,k)}if(A.includes(r)){let o=u.parseNumber(e);return d.applyNumberFilter(n,o,i)}return L.includes(r)?d.applyStringFilter(n,e,i):!0}function Q(s,t,r){let e=s.find(i=>i.filter_name===t);return e?e.filters.every(i=>W(i,r)):!0}function R(s,t,r){return s.filter(e=>{switch(t){case"all":return!0;case"downloaded":return e.trailer_exists;case"downloading":return e.status.toLowerCase()==="downloading";case"missing":return!e.trailer_exists;case"monitored":return e.monitor;case"unmonitored":return!e.monitor&&!e.trailer_exists;case"movies":return e.is_movie&&e.trailer_exists;case"series":return!e.is_movie&&e.trailer_exists;default:return Q(r,t,e)}})}function H(s,t,r){s.sort((e,i)=>{let n=e[t],o=i[t];return n instanceof Date&&o instanceof Date?r?n.getTime()-o.getTime():o.getTime()-n.getTime():typeof n=="number"&&typeof o=="number"?r?n-o:o-n:r?e[t].toString().localeCompare(i[t].toString()):i[t].toString().localeCompare(e[t].toString())})}function B(s){return _(D({},s),{added_at:new Date(`${s.added_at}Z`),updated_at:new Date(`${s.updated_at}Z`),downloaded_at:new Date(`${s.downloaded_at}Z`),isImageLoaded:!1})}function T(s){let t=[{type:"folder",name:"None",size:"",path:"",files:[],modified:new Date,isExpanded:!1}];return s.files&&(t=s.files.map(r=>Z(r)?K(r):T(r))),_(D({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`),files:t})}function K(s){return _(D({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`)})}function Z(s){return s.type==="file"}var he=(()=>{let t=class t{constructor(){this.httpClient=y(v),this.customfilterService=y(U),this.webSocketService=y(O),this.mediaUrl=w.apiUrl+w.media,this.customFilters=this.customfilterService.viewFilters,this.defaultDisplayCount=50,this.checkedMediaIDs=l([]),this.displayCount=l(this.defaultDisplayCount),this.inEditMode=l(!1),this.moviesOnly=l(null),this.selectedMediaID=l(null),this.selectedSort=l("added_at"),this.sortAscending=l(!0),this.selectedFilter=l("all"),this.mediaResource=x(()=>({url:this.mediaUrl+"all"}),{defaultValue:[],parse:e=>e&&Array.isArray(e)?e.map(B):[]}),this.filteredSortedMedia=m(()=>{let e=R(this.allMedia(),this.selectedFilter(),this.customFilters());return H(e,this.selectedSort(),this.sortAscending()),e}),this.displayMedia=m(()=>this.filteredSortedMedia().slice(0,this.displayCount())),this.selectedMedia=m(()=>{let e=this.selectedMediaID();return e===null?null:this.mediaResource.value().find(i=>i.id===e)||null}),this.previousMedia=m(()=>{let e=this.selectedMediaID();if(e===null)return null;let i=this.filteredSortedMedia(),n=i.findIndex(o=>o.id===e);return n>0?i[n-1]:null}),this.nextMedia=m(()=>{let e=this.selectedMediaID();if(e===null)return null;let i=this.filteredSortedMedia(),n=i.findIndex(o=>o.id===e);return n<i.length-1?i[n+1]:null}),this.allMedia=m(()=>{switch(this.moviesOnly()){case!0:return this.mediaResource.value().filter(i=>i.is_movie);case!1:return this.mediaResource.value().filter(i=>!i.is_movie);case null:return this.mediaResource.value().filter(i=>i.status.toLowerCase()==="downloaded")}}),this.webSocketService.toastMessage.pipe(C()).subscribe(e=>{let i=e.message.toLowerCase();["media","trailer","task","download","batch","update","delete","monitor","unmonitor"].some(o=>o&&i.includes(o))&&this.mediaResource.reload()})}searchMedia(e){let i=`${this.mediaUrl}search`,n=new M().set("query",e);return this.httpClient.get(i,{params:n})}batchUpdate(e,i,n=-1){let o=`${this.mediaUrl}batch_update`;return this.httpClient.post(o,{media_ids:e,action:i.toLowerCase(),profile_id:n})}downloadMediaTrailer(e,i,n){let o=new M().set("profile_id",i).set("yt_id",n),g=`${this.mediaUrl}${e}/download`;return this.httpClient.post(g,{},{params:o})}monitorMedia(e,i){let n=new M().set("monitor",i),o=`${this.mediaUrl}${e}/monitor`;return this.httpClient.post(o,{},{params:n})}deleteMediaTrailer(e){let i=`${this.mediaUrl}${e}/trailer`;return this.httpClient.delete(i)}fetchMediaFiles(e){return F(this,null,function*(){let i=`${this.mediaUrl}${e}/files`,n=yield $(this.httpClient.get(i));return T(n)})}searchMediaTrailer(e,i){let n=new M().set("profile_id",i),o=`${this.mediaUrl}${e}/search`;return this.httpClient.post(o,{},{params:n})}saveMediaTrailer(e,i){let n=`${this.mediaUrl}${e}/update`,o=new M().set("yt_id",i);return this.httpClient.post(n,{},{params:o})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"});let s=t;return s})();export{j as a,z as b,G as c,J as d,P as e,he as f};
