import{B as $,C as w,D as le,E as ae,F,G as V,H as E,I as P,J as h,K as se}from"./chunk-GX43XB6K.js";import{B as K,C as J,D as W,E as X,F as Y,G as ee,H as te,K as ie,L as ne,M as oe,N as re,p as Q,q as g,r as H,s as Z,w as U,x as z}from"./chunk-3N2GIQV3.js";import{a as de}from"./chunk-6X7BT2W6.js";import{Eb as q,Fb as G,Ia as c,Kb as u,Mb as T,Ra as I,Vb as f,Ya as L,da as M,fb as x,fc as O,gb as y,gc as j,hb as B,ib as D,ja as p,jb as b,ka as _,kb as S,kc as k,la as A,lb as d,lc as R,mb as o,nb as r,ob as m,tb as N,xb as C,zb as s}from"./chunk-APGJX63Q.js";var ce=["customFilterDialog"];function ue(n,l){n&1&&m(0,"app-load-indicator",1)}function me(n,l){if(n&1&&(o(0,"option",16),u(1),r()),n&2){let i=l.$implicit,e=s(3);d("value",i),c(),T(" ",e.displayTitle(i)," ")}}function pe(n,l){if(n&1&&(o(0,"option",16),u(1),r()),n&2){let i=l.$implicit,e=s(3);d("value",i),c(),T(" ",e.displayTitle(i)," ")}}function _e(n,l){if(n&1&&m(0,"input",18),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function fe(n,l){if(n&1&&m(0,"input",19),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function ge(n,l){if(n&1&&(m(0,"input",25),o(1,"span"),u(2," days"),r()),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function Ce(n,l){if(n&1&&m(0,"input",20),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function he(n,l){if(n&1&&(o(0,"select",21)(1,"option",26),u(2,"True"),r(),o(3,"option",27),u(4,"False"),r()()),n&2){let i=s().$index;d("id",f("filter_value_",i))}}function ve(n,l){if(n&1){let i=N();o(0,"div",8)(1,"div",4)(2,"select",14),C("change",function(t){let a=p(i).$index,v=s(2);return _(v.onFilterByChange(t,a))}),o(3,"option",15),u(4,"Select Filter By"),r(),b(5,me,2,2,"option",16,D),r()(),o(7,"div",4)(8,"select",17),C("change",function(t){let a=p(i).$index,v=s(2);return _(v.onFilterConditionChange(t,a))}),o(9,"option",15),u(10,"Select Condition"),r(),b(11,pe,2,2,"option",16,D),r()(),o(13,"div",4),x(14,_e,1,2,"input",18)(15,fe,1,2,"input",19)(16,ge,3,2)(17,Ce,1,2,"input",20)(18,he,5,2,"select",21),r(),o(19,"button",22),C("click",function(){let t=p(i).$index,a=s(2);return _(a.removeFilter(t))}),A(),o(20,"svg",23),m(21,"path",24),r()()()}if(n&2){let i=l.$index,e=s(2);d("formGroupName",i),c(2),d("id",f("filter_by_",i)),c(3),S(e.filterKeys),c(3),d("id",f("filter_condition_",i)),c(3),S(e.filterConditions[i]),c(3),y(e.filterValueTypes[i]==="string"?14:e.filterValueTypes[i]==="number"?15:e.filterValueTypes[i]==="number_days"?16:e.filterValueTypes[i]==="date"?17:e.filterValueTypes[i]==="boolean"?18:-1)}}function Fe(n,l){if(n&1&&(o(0,"button",12),u(1),r()),n&2){let i=s(2);d("disabled",i.customFilterForm.pristine||i.customFilterForm.invalid||i.submitting),c(),T(" ",i.customFilter()?"Update":"Create"," ")}}function xe(n,l){n&1&&(o(0,"div",13),A(),o(1,"svg",28)(2,"circle",29),m(3,"animate",30),r(),o(4,"circle",31),m(5,"animate",32),r(),o(6,"circle",33),m(7,"animate",34),r()()())}function ye(n,l){if(n&1){let i=N();o(0,"form",3),C("ngSubmit",function(){p(i);let t=s();return _(t.onSubmit())})("click",function(t){return p(i),_(t.stopPropagation())}),o(1,"div",4)(2,"label",5),u(3,"Label"),r(),m(4,"input",6),r(),o(5,"div",7),b(6,ve,22,6,"div",8,B),o(8,"button",9),C("click",function(){p(i);let t=s();return _(t.addFilter())}),u(9,"Add Filter"),r()(),o(10,"div",10)(11,"button",11),C("click",function(){p(i);let t=s();return _(t.closeDialog(-1))}),u(12,"Cancel"),r(),x(13,Fe,2,2,"button",12)(14,xe,8,0,"div",13),r()()}if(n&2){let i=s();d("formGroup",i.customFilterForm),c(6),S(i.filters.controls),c(7),y(i.submitting?14:13)}}var Ne=(()=>{let l=class l{constructor(){this.fb=M(ne),this.filterType=k.required(),this.filterTypeValue=O(()=>{let e=this.filterType().toUpperCase();return e=="MOVIES"?h.MOVIES:e=="SERIES"?h.SERIES:e=="TRAILER"?h.TRAILER:h.HOME}),this.customFilter=k(null),this.dialogClosed=new L,this.isLoading=!0,this.customfilterService=M(se),this.computedSignal=O(()=>{let e=this.customFilter();return this.initForm(e),!0}),this.boolFilterConditions=Object.values($),this.dateFilterConditions=Object.values(w),this.numberFilterConditions=Object.values(le),this.stringFilterConditions=Object.values(ae),this.filterConditions=[],this.filterValueTypes=[],this.filterKeys=F.concat(V,E,P).sort(),this.viewForOptions=Object.values(h),this.customFilterDialog=R.required("customFilterDialog"),this.submitting=!1,j(()=>{this.initForm(this.customFilter())})}ngAfterViewInit(){this.customFilterDialog().nativeElement.showModal()}closeDialog(e){this.customFilterDialog().nativeElement.close(),this.dialogClosed.emit(e),this.filters.clear(),this.addFilter(),this.customFilterForm.reset()}displayTitle(e){return e.toLowerCase().replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}initForm(e){let t=this.fb.group({id:[e?e.id:null],filter_type:[e?e.filter_type:this.filterTypeValue(),g.required],filter_name:[e?e.filter_name:"",[g.required,g.maxLength(100)]],filters:this.fb.array([],g.required)});return this.customFilterForm=t,e&&e.filters&&e.filters.length?e.filters.forEach(a=>{this.addFilter(a)}):this.addFilter(),this.isLoading=!1,t}get filters(){return this.customFilterForm.get("filters")}createFilter(e){return this.fb.group({id:[e?e.id:null],filter_by:[e?e.filter_by:"",g.required],filter_condition:[e?e.filter_condition:"",g.required],filter_value:[e?e.filter_value:"",g.required],customfilter_id:[e?e.customfilter_id:null]})}getFilterConditions(e){return F.includes(e)?this.boolFilterConditions:V.includes(e)?this.dateFilterConditions:E.includes(e)?this.numberFilterConditions:P.includes(e)?this.stringFilterConditions:[]}getFilterValueType(e,t){return F.includes(e)?"boolean":V.includes(e)?t===w.IN_THE_LAST||t===w.NOT_IN_THE_LAST?"number_days":"date":E.includes(e)?"number":"string"}addFilter(e){e&&e.filter_by?(this.filterConditions.push(this.getFilterConditions(e.filter_by)),this.filterValueTypes.push(this.getFilterValueType(e.filter_by,e.filter_condition))):(this.filterConditions.push([]),this.filterValueTypes.push("string")),this.filters.push(this.createFilter(e))}removeFilter(e){this.filterConditions.splice(e,1),this.filters.removeAt(e)}onFilterByChange(e,t){let a=this.filters.at(t).get("filter_by")?.value;this.filterConditions[t]=this.getFilterConditions(a),this.filterValueTypes[t]=this.getFilterValueType(a,""),this.filters.at(t).get("filter_condition")?.setValue(""),F.includes(a)&&this.filters.at(t).get("filter_condition")?.setValue($.EQUALS),this.filters.at(t).get("filter_value")?.reset()}onFilterConditionChange(e,t){let a=this.filters.at(t).get("filter_by")?.value;if(e.target){let v=e.target.value;this.filterValueTypes[t]=this.getFilterValueType(a,v)}this.filters.at(t).get("filter_value")?.reset()}onSubmit(){if(!this.submitting)if(this.submitting=!0,this.customFilterForm.valid){let e=this.customFilterForm.value;e.filters.forEach(t=>{t.filter_value=t.filter_value.toString()}),this.customFilter()?.id?this.customfilterService.update(e).subscribe(t=>{this.closeDialog(t.id),this.submitting=!1}):this.customfilterService.create(e).subscribe(t=>{this.closeDialog(t.id),this.submitting=!1})}else console.log("Form is invalid"),this.customFilterForm.markAllAsTouched(),this.submitting=!1}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=I({type:l,selectors:[["app-add-filter-dialog"]],viewQuery:function(t,a){t&1&&q(a.customFilterDialog,ce,5),t&2&&G()},inputs:{filterType:[1,"filterType"],customFilter:[1,"customFilter"]},outputs:{dialogClosed:"dialogClosed"},decls:4,vars:1,consts:[["customFilterDialog",""],[1,"center"],[3,"formGroup"],[3,"ngSubmit","click","formGroup"],[1,"form-group"],["for","filter_name"],["id","filter_name","type","text","maxlength","100","formControlName","filter_name"],["formArrayName","filters",1,"filters-container"],[1,"filter-group",3,"formGroupName"],["type","button",1,"secondary",3,"click"],[1,"buttons-row"],["type","button",1,"danger",3,"click"],["type","submit",1,"primary",3,"disabled"],["title","Submitting form data"],["formControlName","filter_by",3,"change","id"],["value","","disabled",""],[3,"value"],["formControlName","filter_condition",3,"change","id"],["type","text","formControlName","filter_value",3,"id"],["type","number","formControlName","filter_value",3,"id"],["type","date","formControlName","filter_value",3,"id"],["formControlName","filter_value",3,"id"],["type","button",1,"danger","icononly-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M253-99q-38.21 0-65.11-26.6Q161-152.2 161-190v-552h-58v-91h228v-47h297v47h228v91h-58v552q0 37.18-27.21 64.09Q743.59-99 706-99H253Zm453-643H253v552h453v-552ZM357-268h74v-398h-74v398Zm173 0h75v-398h-75v398ZM253-742v552-552Z"],["type","number","placeholder","days","formControlName","filter_value",3,"id"],["value","true"],["value","false"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 200",1,"icon-loading"],["stroke-width","14","r","15","cx","40","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.4"],["stroke-width","14","r","15","cx","100","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.2"],["stroke-width","14","r","15","cx","160","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","0"]],template:function(t,a){t&1&&(o(0,"dialog",null,0),x(2,ue,1,0,"app-load-indicator",1)(3,ye,15,2,"form",2),r()),t&2&&(c(2),y(a.isLoading?2:3))},dependencies:[oe,U,ee,te,Q,z,Y,H,Z,ie,de,re,K,X,J,W],styles:["[_nghost-%COMP%]{display:contents}.center[_ngcontent-%COMP%]{margin:auto}form[_ngcontent-%COMP%]{padding:1rem;display:block flex;flex-direction:column;gap:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.4rem;font-weight:700}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.5rem;box-sizing:border-box}option[_ngcontent-%COMP%]{background-color:var(--color-surface-container-high)}.ng-touched.ng-invalid[_ngcontent-%COMP%]:not(form):not(div){border:2px solid var(--color-danger)}.error[_ngcontent-%COMP%]{color:var(--color-danger);font-size:.9rem;margin-top:.4rem}.filters-container[_ngcontent-%COMP%]{border-top:1px solid var(--color-outline);padding-top:1rem}.filter-group[_ngcontent-%COMP%]{display:block flex;flex-wrap:wrap;gap:1rem;align-items:center;border:1px solid var(--color-outline);border-radius:.5rem;padding:.5rem;margin-bottom:.75rem;background-color:var(--color-surface-container-high)}.filter-group[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:nth-child(3){flex:1;text-align:start}.danger[_ngcontent-%COMP%]{width:auto;height:auto}.danger[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-danger-text)}.buttons-row[_ngcontent-%COMP%]{display:block flex;align-items:center;justify-content:space-around}.icon-loading[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;fill:var(--color-on-surface)}"]});let n=l;return n})();export{Ne as a};
