import{a as x}from"./chunk-QD2V5FY5.js";import{C as m,D as h,E as o,F as A,G as b,H as U,I as L,K as O}from"./chunk-GJS7FWDK.js";import{a as v}from"./chunk-LTSMKAU7.js";import{Z as C,_b as p,a as w,b as D,c as N,ca as T,nc as _,p as d,qc as I,ra as l,sc as E,tc as F,v as $}from"./chunk-IZTUW6FH.js";function B(s){let e=Math.floor(s/60),i=Math.floor(s%60);return e===0?`${i}m`:i===0?`${e}h`:`${e}h ${i}m`}function J(s){let e=Date.now();if(s<e||(s-=e,s<0))return"0 seconds";let i=Math.floor(s/36e5),t=Math.floor(s%36e5/6e4),r=Math.floor(s%6e4/1e3);return i===0&&t===0&&r===0?"0 seconds":i===0&&t===0?`${r} seconds`:i===0?`${t} minutes ${r} seconds`:`${i} hours ${t} minutes ${r} seconds`}var q=(s,e)=>s===e||JSON.stringify(s)===JSON.stringify(e),g=new Map;function f(s=0){return function(e,i,t){let r=t.value;t.value=function(...n){let a=`${i.toString()}:${JSON.stringify(n)}`;if(g.has(a)){let y=g.get(a);if(s>0&&Date.now()-y.timestamp>s)g.delete(a);else return y.value}let S=r.apply(this,n);return g.set(a,{value:S,timestamp:Date.now()}),S}}}var u=class{static parseDate(e){return new Date(e)}static parseNumber(e){return parseFloat(e)}static getDaysAgo(e){let i=new Date;return i.setDate(i.getDate()-e),i}};d([f()],u,"parseDate",null);d([f()],u,"parseNumber",null);d([f()],u,"getDaysAgo",null);var c=class{static applyBooleanFilter(e,i){return e===i}static applyNumberFilter(e,i,t){switch(t){case h.GREATER_THAN:return e>i;case h.GREATER_THAN_EQUAL:return e>=i;case h.LESS_THAN:return e<i;case h.LESS_THAN_EQUAL:return e<=i;case h.EQUALS:return e===i;case h.NOT_EQUALS:return e!==i;default:return!0}}static applyDateFilter(e,i,t,r){switch(t){case m.IS_AFTER:return e>i;case m.IS_BEFORE:return e<i;case m.IN_THE_LAST:return r?e>r:!1;case m.NOT_IN_THE_LAST:return r?e<r:!1;case m.EQUALS:return e.toDateString()===i.toDateString();case m.NOT_EQUALS:return e.toDateString()!==i.toDateString();default:return!0}}static applyStringFilter(e,i,t){switch(t){case o.CONTAINS:return e.includes(i);case o.NOT_CONTAINS:return!e.includes(i);case o.EQUALS:return e===i;case o.NOT_EQUALS:return e!==i;case o.STARTS_WITH:return e.startsWith(i);case o.NOT_STARTS_WITH:return!e.startsWith(i);case o.ENDS_WITH:return e.endsWith(i);case o.NOT_ENDS_WITH:return!e.endsWith(i);case o.IS_EMPTY:return e==="";case o.IS_NOT_EMPTY:return e!=="";default:return!0}}};d([f()],c,"applyBooleanFilter",null);d([f()],c,"applyNumberFilter",null);d([f()],c,"applyDateFilter",null);function Q(s,e){let{filter_by:i,filter_value:t,filter_condition:r}=s,n=e[i];if(A.includes(i)){let a=t.toLowerCase()==="true";return c.applyBooleanFilter(n,a)}if(b.includes(i)){let a=u.parseDate(n),S=u.parseDate(t),y=parseInt(t),W=isNaN(y)?void 0:u.getDaysAgo(y);return c.applyDateFilter(a,S,r,W)}if(U.includes(i)){let a=u.parseNumber(t);return c.applyNumberFilter(n,a,r)}return L.includes(i)?c.applyStringFilter(n,t,r):!0}function K(s,e,i){let t=s.find(r=>r.filter_name===e);return t?t.filters.every(r=>Q(r,i)):!0}function R(s,e,i){return s.filter(t=>{switch(e){case"all":return!0;case"downloaded":return t.trailer_exists;case"downloading":return t.status.toLowerCase()==="downloading";case"missing":return!t.trailer_exists;case"monitored":return t.monitor;case"unmonitored":return!t.monitor&&!t.trailer_exists;case"movies":return t.is_movie&&t.trailer_exists;case"series":return!t.is_movie&&t.trailer_exists;default:return K(i,e,t)}})}function H(s,e,i){s.sort((t,r)=>{let n=t[e],a=r[e];return n instanceof Date&&a instanceof Date?i?n.getTime()-a.getTime():a.getTime()-n.getTime():typeof n=="number"&&typeof a=="number"?i?n-a:a-n:i?t[e].toString().localeCompare(r[e].toString()):r[e].toString().localeCompare(t[e].toString())})}function k(s){return D(w({},s),{added_at:new Date(`${s.added_at}Z`),updated_at:new Date(`${s.updated_at}Z`),downloaded_at:new Date(`${s.downloaded_at}Z`),isImageLoaded:!1})}function M(s){let e=[{type:"folder",name:"None",size:"",path:"",files:[],modified:new Date,isExpanded:!1}];return s.files&&(e=s.files.map(i=>j(i)?Z(i):M(i))),D(w({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`),files:e})}function Z(s){return D(w({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`)})}function j(s){return s.type==="file"}var pt=(()=>{let e=class e{constructor(){this.httpClient=T(I),this.customfilterService=T(O),this.webSocketService=T(v),this.mediaUrl=F.apiUrl+F.media,this.customFilters=this.customfilterService.viewFilters,this.defaultDisplayCount=50,this.checkedMediaIDs=l([]),this.displayCount=l(this.defaultDisplayCount),this.inEditMode=l(!1),this.moviesOnly=l(null),this.selectedMediaID=l(null),this.selectedSort=l("added_at"),this.sortAscending=l(!0),this.selectedFilter=l("all"),this.mediaResource=E(()=>({url:this.mediaUrl+"all"}),{defaultValue:[],parse:t=>t&&Array.isArray(t)?t.map(k):[]}),this.filteredSortedMedia=p(()=>{let t=R(this.allMedia(),this.selectedFilter(),this.customFilters());return H(t,this.selectedSort(),this.sortAscending()),t}),this.displayMedia=p(()=>this.filteredSortedMedia().slice(0,this.displayCount())),this.selectedMedia=p(()=>{let t=this.selectedMediaID();return t===null?null:this.mediaResource.value().find(r=>r.id===t)||null}),this.previousMedia=p(()=>{let t=this.selectedMediaID();if(t===null)return null;let r=this.filteredSortedMedia(),n=r.findIndex(a=>a.id===t);return n>0?r[n-1]:null}),this.nextMedia=p(()=>{let t=this.selectedMediaID();if(t===null)return null;let r=this.filteredSortedMedia(),n=r.findIndex(a=>a.id===t);return n<r.length-1?r[n+1]:null}),this.allMedia=p(()=>{switch(this.moviesOnly()){case!0:return this.mediaResource.value().filter(r=>r.is_movie);case!1:return this.mediaResource.value().filter(r=>!r.is_movie);case null:return this.mediaResource.value().filter(r=>r.status.toLowerCase()==="downloaded")}}),this.webSocketService.toastMessage.pipe(x()).subscribe(t=>{let r=t.message.toLowerCase();["media","trailer","task","download","batch","update","delete","monitor","unmonitor"].some(a=>a&&r.includes(a))&&this.mediaResource.reload()})}searchMedia(t){let r=`${this.mediaUrl}search`,n=new _().set("query",t);return this.httpClient.get(r,{params:n})}batchUpdate(t,r,n=-1){let a=`${this.mediaUrl}batch_update`;return this.httpClient.post(a,{media_ids:t,action:r.toLowerCase(),profile_id:n})}downloadMediaTrailer(t,r,n){let a=new _().set("profile_id",r).set("yt_id",n),S=`${this.mediaUrl}${t}/download`;return this.httpClient.post(S,{},{params:a})}monitorMedia(t,r){let n=new _().set("monitor",r),a=`${this.mediaUrl}${t}/monitor`;return this.httpClient.post(a,{},{params:n})}deleteMediaTrailer(t){let r=`${this.mediaUrl}${t}/trailer`;return this.httpClient.delete(r)}fetchMediaFiles(t){return N(this,null,function*(){let r=`${this.mediaUrl}${t}/files`,n=yield $(this.httpClient.get(r));return M(n)})}searchMediaTrailer(t,r){let n=new _().set("profile_id",r),a=`${this.mediaUrl}${t}/search`;return this.httpClient.post(a,{},{params:n})}saveMediaTrailer(t,r){let n=`${this.mediaUrl}${t}/update`,a=new _().set("yt_id",r);return this.httpClient.post(n,{},{params:a})}scanMediaDownloads(t){let r=`${this.mediaUrl}${t}/scan`;return this.httpClient.post(r,{})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();export{B as a,J as b,q as c,pt as d};
